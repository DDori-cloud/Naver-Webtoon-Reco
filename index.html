<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naver Webtoon AI Picker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#8D6E63', bgLight: '#F5F7FA' },
                    boxShadow: { 'soft': '0 10px 40px rgba(0,0,0,0.05)', 'blue': '0 15px 45px rgba(141,110,99,0.2)' }
                }
            }
        }
    </script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #F5F7FA;
            background-image: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)), url('bg.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            -webkit-font-smoothing: antialiased;
        }

        .animate-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .backdrop-blur-custom {
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
        }

        .modal-open {
            overflow: hidden !important;
        }

        .premium-gray-btn {
            background: #F8FAFC;
            border: 1px solid #F1F5F9;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .premium-gray-btn:hover {
            background: #F1F5F9;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        @keyframes blink {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.03);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-blink {
            animation: blink 2s infinite ease-in-out;
        }
    </style>
    <!-- Kakao SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div id="root"></div>

    <!-- React/Babel CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="data.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Supabase Config ---
        const SUPABASE_URL = 'https://vxzdgyentxxipjervdzq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ4emRneWVudHh4aXBqZXJ2ZHpxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MjQ0ODEsImV4cCI6MjA4NDQwMDQ4MX0.HyZIWay1RI7JHVdVYpkWBTtjg9goQH4muUEaqqG6fPU';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- Kakao Key Management ---
        const KAKAO_JS_KEY = '7716eb056c6c408381180fb2987a0279';

        const initKakao = () => {
            if (window.Kakao && !Kakao.isInitialized()) {
                try { Kakao.init(KAKAO_JS_KEY); } catch (e) { console.error("Kakao Init Failed:", e); }
            }
        };

        const TRANSLATIONS = {
            ko: {
                subtitle: "ÎÇòÏùò Ï∑®Ìñ•Ïóê ÎßûÎäî ÎÑ§Ïù¥Î≤ÑÏõπÌà∞ Ï∞æÍ∏∞(With AI)",
                process: "Î∂ÑÏÑù ÌîÑÎ°úÏÑ∏Ïä§",
                step: "Îã®Í≥Ñ",
                of: "/",
                share: "Í≥µÏú†ÌïòÍ∏∞",
                step1_title: "ÏÑ†Ìò∏Ï∑®Ìñ•ÏùÑ Í≥®ÎùºÏ£ºÏÑ∏Ïöî.",
                step1_desc: "Îã§ÏñëÌïú Ïû•Î•¥ Ï§ë 1Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉùÏù¥ ÌïÑÏàòÏûÖÎãàÎã§.",
                cat_status: "Ïó∞Ïû¨ ÏÉÅÌÉú",
                cat_genre: "Î©îÏù∏ Ïû•Î•¥",
                cat_topic: "Ïù∏Í∏∞ ÏÜåÏû¨",
                cat_feature: "Ïä§ÌÜ†Î¶¨ ÌäπÏßï",
                next: "Îã§Ïùå Îã®Í≥Ñ",
                step2_title: "ÎπÑÏÑ†Ìò∏ Ï∑®Ìñ•ÏùÑ Í≥®ÎùºÏ£ºÏÑ∏Ïöî (ÏÑ†ÌÉù)",
                step2_desc: "ÏÑ†ÌÉùÌïú Ï∑®Ìñ•Ïù¥ Ìè¨Ìï®Îêú ÏõπÌà∞ÏùÄ Ï∂îÏ≤úÏóêÏÑú Ï†úÏô∏Îê©ÎãàÎã§.",
                back: "Ïù¥Ï†Ñ",
                continue: "Í≥ÑÏÜçÌïòÍ∏∞",
                step3_title: "Í∞ÄÏû• Ïû¨ÎØ∏ÏûàÍ≤å Î≥¥Ïã†\nÏõπÌà∞ÏùÄ Î¨¥ÏóáÏù∏Í∞ÄÏöî?",
                step3_placeholder: "ÏõπÌà∞ Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî",
                start_analysis: "Î∂ÑÏÑù ÏãúÏûë",
                computing: "Í≤∞Í≥º Í≥ÑÏÇ∞ Ï§ë...",
                result_title: "AI Ï∂îÏ≤ú Í≤∞Í≥º",
                result_desc: "ÏÇ¨Ïö©ÏûêÏùò Í≥†Ïú† Ï∑®Ìñ•ÏùÑ Î∂ÑÏÑùÌïú Í≤∞Í≥ºÏûÖÎãàÎã§.",
                exclude: "Ï∂îÏ≤úÏ†úÏô∏",
                view_now: "Î∞îÎ°úÎ≥¥Í∏∞",
                new_analysis: "ÏÉàÎ°úÏö¥ Î∂ÑÏÑù",
                exclude_msg: "ÏïûÏúºÎ°ú Ïù¥ ÏõπÌà∞ÏùÄ Ï∂îÏ≤úÎêòÏßÄ ÏïäÏäµÎãàÎã§.",
                share_copy: "Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!",
                share_fail: "Î≥µÏÇ¨ Ïã§Ìå®",
                share_tpl_title: "[AIR.NW] AI Ï∂îÏ≤ú Í≤∞Í≥º",
                share_tpl_link: "ÎÇòÎèÑ Ìï¥Î≥¥Í∏∞",
                share_modal_title: "Í≥µÏú†ÌïòÍ∏∞",
                share_to_kakao: "Ïπ¥Ïπ¥Ïò§ÌÜ°",
                share_to_line: "ÎùºÏù∏",
                share_to_tiktok: "Ìã±ÌÜ°",
                share_to_text: "Í≤∞Í≥º Î≥µÏÇ¨",
                share_to_system: "Í∏∞ÌÉÄ Í≥µÏú†",
                conflict_msg: "Îã®Í≥Ñ 1ÏóêÏÑú ÏÑ†ÌÉùÌïú ÏÑ†Ìò∏ ÌÉúÍ∑∏ÏûÖÎãàÎã§.\nÎπÑÏÑ†Ìò∏Î°ú Î∞îÍæ∏ÏãúÍ≤†ÏäµÎãàÍπå?",
                yes: "Ïòà",
                no: "ÏïÑÎãàÏò§",
                main: "Î©îÏù∏",
                ongoing: "Ïó∞Ïû¨Ï§ë",
                finished: "ÏôÑÍ≤∞",
                login: "Î°úÍ∑∏Ïù∏",
                logout: "Î°úÍ∑∏ÏïÑÏõÉ",
                email: "Ïù¥Î©îÏùº",
                password: "ÎπÑÎ∞ÄÎ≤àÌò∏",
                login_btn: "Î°úÍ∑∏Ïù∏",
                signup_btn: "ÌöåÏõêÍ∞ÄÏûÖ",
                social_login: "ÏÜåÏÖú Î°úÍ∑∏Ïù∏",
                auth_title: "Î°úÍ∑∏Ïù∏ / ÌöåÏõêÍ∞ÄÏûÖ",
                like: "Ï¢ãÏïÑÏöî",
                my_info: "ÎÇ¥ Ï†ïÎ≥¥",
                liked_list: "ÏÑ†Ìò∏ ÏûëÌíà (Ï¢ãÏïÑÏöî)",
                excluded_list: "ÎπÑÏÑ†Ìò∏ ÏûëÌíà (Ïã´Ïñ¥Ïöî)",
                delete_account: "ÌöåÏõê ÌÉàÌá¥",
                find_pw: "ÎπÑÎ∞ÄÎ≤àÌò∏ Ï∞æÍ∏∞",
                reset_pw_msg: "Ïù¥Î©îÏùºÎ°ú ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï ÎßÅÌÅ¨Í∞Ä Î∞úÍ∏âÎê©ÎãàÎã§.",
                delete_confirm: "Ï†ïÎßêÎ°ú ÌÉàÌá¥ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏ†ÄÏû•Îêú Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.",
                no_data: "Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.",
                password_confirm: "ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÌôïÏù∏",
                pw_mismatch: "ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.",
                pw_criteria: "ÎπÑÎ∞ÄÎ≤àÌò∏Îäî 6Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.",
                email_invalid: "Ïú†Ìö®Ìïú Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.",
                go_to_signup: "ÏïÑÏßÅ Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî? ÌöåÏõêÍ∞ÄÏûÖ",
                go_to_login: "Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî? Î°úÍ∑∏Ïù∏",
                signup_confirm_msg: "Í∞ÄÏûÖ ÌôïÏù∏ Î©îÏùºÏù¥ Î∞úÏÜ°ÎêòÏóàÏäµÎãàÎã§! Î©îÏùºÌï®ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.",
                login_error_msg: "Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.",
                signup_success: "ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!",
                worldcup: "ÏõπÌà∞ ÏõîÎìúÏªµ",
                worldcup_title: "ÏõπÌà∞ Ïù¥ÏÉÅÌòï ÏõîÎìúÏªµ",
                worldcup_select_round: "ÎùºÏö¥Îìú ÏÑ†ÌÉù",
                worldcup_start: "ÏãúÏûëÌïòÍ∏∞",
                worldcup_vs: "VS",
                worldcup_round: "Í∞ï",
                worldcup_final: "Í≤∞Ïäπ",
                worldcup_winner: "Ïö∞Ïäπ",
                worldcup_result: "ÏõîÎìúÏªµ Í≤∞Í≥º",
                worldcup_history: "ÏõîÎìúÏªµ Í∏∞Î°ù",
                exclude_from_reco: "Ï∂îÏ≤ú Ï†úÏô∏",
                exclude_from_reco_desc: "ÏÑ†Ìò∏ÎèÑÏóêÎäî ÏòÅÌñ•ÏùÑ Ï£ºÏßÄÎßå Ï∂îÏ≤ú Í≤∞Í≥ºÏóêÏÑúÎäî Ï†úÏô∏Îê©ÎãàÎã§",
                today_visitors: "Ïò§Îäò Î∞©Î¨∏Ïûê",
                total_visitors: "Ï¥ù Î∞©Î¨∏Ïûê"
            },
            en: {
                subtitle: "Find Naver Webtoons That Match Your Taste(With AI)",
                process: "Analysis Process",
                step: "Step",
                of: "of",
                share: "Share",
                step1_title: "Choose Preferred Tastes",
                step1_desc: "Please select at least one genre.",
                cat_status: "Status",
                cat_genre: "Main Genre",
                cat_topic: "Popular Topics",
                cat_feature: "Story Features",
                next: "Next Step",
                step2_title: "Choose Non-preferred Tastes (Optional)",
                step2_desc: "Webtoons with these tags will be strictly excluded.",
                back: "Back",
                continue: "Continue",
                step3_title: "What is your\nfavorite webtoon?",
                step3_placeholder: "Enter the webtoon title",
                start_analysis: "Start Analysis",
                computing: "Computing Result...",
                result_title: "AI Best Recommendations",
                result_desc: "Analyzed based on your unique preferences.",
                exclude: "Exclude",
                view_now: "View Now",
                new_analysis: "New Analysis",
                exclude_msg: "This webtoon will no longer be recommended.",
                share_copy: "Results copied to clipboard!",
                share_fail: "Copy failed.",
                share_tpl_title: "[AIR.NW] AI Recommended Results",
                share_tpl_link: "Try it yourself",
                share_modal_title: "Share Results",
                share_to_kakao: "KakaoTalk",
                share_to_line: "LINE",
                share_to_tiktok: "TikTok",
                share_to_text: "Copy Results",
                share_to_system: "Others",
                conflict_msg: "This is a preferred tag from Step 1.\nChange it to non-preferred?",
                yes: "Yes",
                no: "No",
                main: "Main",
                ongoing: "Ongoing",
                finished: "Finished",
                login: "Login",
                logout: "Logout",
                email: "Email",
                password: "Password",
                login_btn: "Login",
                signup_btn: "Sign Up",
                auth_title: "Login / Sign Up",
                like: "Like",
                my_info: "My Info",
                liked_list: "Preferred (Like)",
                excluded_list: "Disliked",
                delete_account: "Delete Account",
                find_pw: "Forgot Password?",
                reset_pw_msg: "A password reset link has been sent to your email.",
                delete_confirm: "Are you sure you want to delete your account?\nAll saved data will be permanently removed.",
                no_data: "No data found.",
                password_confirm: "Confirm Password",
                pw_mismatch: "Passwords do not match.",
                pw_criteria: "Password must be at least 6 characters.",
                email_invalid: "Please enter a valid email.",
                go_to_signup: "Don't have an account? Sign Up",
                go_to_login: "Already have an account? Login",
                signup_confirm_msg: "Confirmation email sent! Please check your inbox.",
                login_error_msg: "Invalid login credentials.",
                signup_success: "Sign-up completed successfully!",
                worldcup: "Webtoon Worldcup",
                worldcup_title: "Webtoon Ideal Type Worldcup",
                worldcup_select_round: "Select Round",
                worldcup_start: "Start",
                worldcup_vs: "VS",
                worldcup_round: "Round",
                worldcup_final: "Final",
                worldcup_winner: "Winner",
                worldcup_result: "Worldcup Result",
                worldcup_history: "Worldcup History",
                exclude_from_reco: "Exclude from Recommendations",
                exclude_from_reco_desc: "Affects preference but excluded from recommendation results",
                today_visitors: "Today",
                total_visitors: "Total"
            },
            zh: {
                subtitle: "My Pick Naver WebToon(with AI)",
                process: "ÂàÜÊûêËøõÂ∫¶",
                step: "Á¨¨",
                of: "Ê≠• / ÂÖ±",
                share: "ÂàÜ‰∫´",
                step1_title: "ËØ∑ÈÄâÊã©ÊÇ®ÂñúÂ•ΩÁöÑÂè£Âë≥",
                step1_desc: "ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™Á±ªÂà´„ÄÇ",
                cat_status: "ËøûËΩΩÁä∂ÊÄÅ",
                cat_genre: "‰∏ªÊâìÁ±ªÂûã",
                cat_topic: "ÁÉ≠Èó®Á¥†Êùê",
                cat_feature: "ÂâßÊÉÖÁâπÁÇπ",
                next: "‰∏ã‰∏ÄÊ≠•",
                step2_title: "ËØ∑ÈÄâÊã©‰∏çÂñúÊ¨¢ÁöÑÂè£Âë≥ (ÂèØÈÄâ)",
                step2_desc: "ÂåÖÂê´ÊâÄÈÄâÊ†áÁ≠æÁöÑÊº´ÁîªÂ∞Ü‰ªéÊé®Ëçê‰∏≠ÊéíÈô§„ÄÇ",
                back: "ËøîÂõû",
                continue: "ÁªßÁª≠",
                step3_title: "ÊÇ®ÊúÄÂñúÊ¨¢ÁöÑ\nÊº´ÁîªÊòØ‰ªÄ‰πàÔºü",
                step3_placeholder: "ËØ∑ËæìÂÖ•Êº´ÁîªÊ†áÈ¢ò",
                start_analysis: "ÂºÄÂßãÂàÜÊûê",
                computing: "Ê≠£Âú®ËÆ°ÁÆóÁªìÊûú...",
                result_title: "AI ÊúÄ‰Ω≥Êé®Ëçê",
                result_desc: "Ê†πÊçÆÊÇ®ÁöÑÁã¨ÁâπÂÅèÂ•ΩÂàÜÊûêÂæóÂá∫„ÄÇ",
                exclude: "‰∏çÂÜçÊé®Ëçê",
                view_now: "Á´ãÂç≥ÈòÖËØª",
                new_analysis: "ÈáçÊñ∞ÂàÜÊûê",
                exclude_msg: "‰ªäÂêéÂ∞Ü‰∏çÂÜçÊé®ËçêÊ≠§Êº´Áîª„ÄÇ",
                share_copy: "ÁªìÊûúÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ",
                share_fail: "Â§çÂà∂Â§±Ë¥•„ÄÇ",
                share_tpl_title: "[AIR.NW] AI Êé®ËçêÁªìÊûú",
                share_tpl_link: "Êàë‰πüË¶ÅËØïËØï",
                share_modal_title: "ÂàÜ‰∫´ÁªìÊûú",
                share_to_kakao: "KakaoTalk",
                share_to_line: "LINE",
                share_to_tiktok: "TikTok",
                share_to_text: "Â§çÂà∂ÁªìÊûú",
                share_to_system: "ÂÖ∂‰ªñ",
                conflict_msg: "ËøôÊòØÊÇ®Âú®Á¨¨1Ê≠•ÈÄâÊã©ÁöÑÂñúÂ•ΩÊ†áÁ≠æ„ÄÇ\nË¶ÅÊîπ‰∏∫‰∏çÂñúÊ¨¢ÁöÑÂêóÔºü",
                yes: "ÊòØ",
                no: "Âê¶",
                main: "‰∏ªÈ°µ",
                ongoing: "ËøûËΩΩÏ§ë",
                finished: "Â∑≤ÂÆåÁªì",
                login: "ÁôªÂΩï",
                logout: "ÁôªÂá∫",
                email: "ÁîµÂ≠êÈÇÆ‰ª∂",
                password: "ÂØÜÁ†Å",
                login_btn: "ÁôªÂΩï",
                signup_btn: "Ê≥®ÂÜå",
                auth_title: "ÁôªÂΩï / Ê≥®ÂÜå",
                like: "ÂñúÊ¨¢",
                my_info: "ÊàëÁöÑ‰ø°ÊÅØ",
                liked_list: "ÊàëÂñúÊ¨¢ÁöÑÊº´Áîª",
                excluded_list: "ÊéíÈô§ÁöÑÊº´Áîª",
                delete_account: "Ê≥®ÈîÄË¥¶Âè∑",
                find_pw: "ÊâæÂõûÂØÜÁ†Å",
                reset_pw_msg: "ÈáçÁΩÆÂØÜÁ†ÅÈìæÊé•Â∑≤ÂèëÈÄÅËá≥ÊÇ®ÁöÑÈÇÆÁÆ±„ÄÇ",
                delete_confirm: "Á°ÆÂÆöË¶ÅÊ≥®ÈîÄË¥¶Âè∑ÂêóÔºü\nÊâÄÊúâ‰øùÂ≠òÁöÑÊï∞ÊçÆÂ∞ÜË¢´Ê∞∏‰πÖÂà†Èô§„ÄÇ",
                no_data: "ÊöÇÊó†Êï∞ÊçÆ„ÄÇ",
                password_confirm: "Á°ÆËÆ§ÂØÜÁ†Å",
                pw_mismatch: "ÂØÜÁ†Å‰∏ç‰∏ÄËá¥„ÄÇ",
                pw_criteria: "ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë‰∏∫ 6 ‰Ωç„ÄÇ",
                email_invalid: "ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÁîµÂ≠êÈÇÆ‰ª∂Âú∞ÂùÄ„ÄÇ",
                go_to_signup: "ËøòÊ≤°ÊúâË¥¶Âè∑ÔºüÊ≥®ÂÜå",
                go_to_login: "Â∑≤ÊúâË¥¶Âè∑ÔºüÁôªÂΩï",
                signup_confirm_msg: "Á°ÆËÆ§ÈÇÆ‰ª∂Â∑≤ÂèëÈÄÅÔºÅËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÊî∂‰ª∂ÁÆ±„ÄÇ",
                login_error_msg: "ÁôªÂΩï‰ø°ÊÅØÊó†Êïà„ÄÇ",
                signup_success: "Ê≥®ÂÜåÊàêÂäüÔºÅ",
                worldcup: "Êº´Áîª‰∏ñÁïåÊùØ",
                worldcup_title: "Êº´ÁîªÁêÜÊÉ≥Âûã‰∏ñÁïåÊùØ",
                worldcup_select_round: "ÈÄâÊã©ËΩÆÊ¨°",
                worldcup_start: "ÂºÄÂßã",
                worldcup_vs: "VS",
                worldcup_round: "Âº∫",
                worldcup_final: "ÂÜ≥Ëµõ",
                worldcup_winner: "ÂÜ†ÂÜõ",
                worldcup_result: "‰∏ñÁïåÊùØÁªìÊûú",
                worldcup_history: "‰∏ñÁïåÊùØËÆ∞ÂΩï",
                exclude_from_reco: "ÊéíÈô§Êé®Ëçê",
                exclude_from_reco_desc: "ÂΩ±ÂìçÂÅèÂ•Ω‰ΩÜ‰∏çÂú®Êé®ËçêÁªìÊûú‰∏≠ÊòæÁ§∫",
                today_visitors: "‰ªäÊó•",
                total_visitors: "ÊÄªËÆ°"
            },
            ja: {
                subtitle: "My Pick Naver WebToon(with AI)",
                process: "ÂàÜÊûê„Éó„É≠„Çª„Çπ",
                step: "„Çπ„ÉÜ„ÉÉ„Éó",
                of: "/",
                share: "ÂÖ±Êúâ„Åô„Çã",
                step1_title: "„ÅäÂ•Ω„Åø„ÅÆ„Çø„Ç§„Éó„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ",
                step1_desc: "1„Å§‰ª•‰∏ä„ÅÆÈÅ∏Êäû„ÅåÂøÖÈ†à„Åß„Åô„ÄÇ",
                cat_status: "ÈÄ£ËºâÁä∂ÊÖã",
                cat_genre: "„É°„Ç§„É≥„Ç∏„É£„É≥„É´",
                cat_topic: "‰∫∫Ê∞ó„ÅÆÁ¥†Êùê",
                cat_feature: "„Çπ„Éà„Éº„É™„Éº„ÅÆÁâπÂæ¥",
                next: "Ê¨°„Å∏",
                step2_title: "Ëã¶Êâã„Å™Â•Ω„Åø„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ (‰ªªÊÑè)",
                step2_desc: "ÈÅ∏Êäû„Åó„Åü„Çø„Ç∞„ÅåÂê´„Åæ„Çå„Çã‰ΩúÂìÅ„ÅØ„Åä„Åô„Åô„ÇÅ„Åã„ÇâÈô§Â§ñ„Åï„Çå„Åæ„Åô„ÄÇ",
                back: "Êàª„Çã",
                continue: "Á∂ö„Åë„Çã",
                step3_title: "‰∏ÄÁï™Èù¢ÁôΩ„Åã„Å£„Åü\n„Ç¶„Çß„Éñ„Éà„Ç•„Éº„É≥„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                step3_placeholder: "„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
                start_analysis: "ÂàÜÊûêÈñãÂßã",
                computing: "ÁµêÊûú„ÇíË®àÁÆó‰∏≠...",
                result_title: "AI „Åä„Åô„Åô„ÇÅÁµêÊûú",
                result_desc: "„ÅÇ„Å™„Åü„ÅÆÂ•Ω„Åø„ÇíÂàÜÊûê„Åó„ÅüÁµêÊûú„Åß„Åô„ÄÇ",
                exclude: "„Åä„Åô„Åô„ÇÅÈô§Â§ñ",
                view_now: "‰ªä„Åô„ÅêË¶ã„Çã",
                new_analysis: "Êñ∞„Åó„ÅÑÂàÜÊûê",
                exclude_msg: "‰ªäÂæå„ÄÅ„Åì„ÅÆ‰ΩúÂìÅ„ÅØ„Åä„Åô„Åô„ÇÅ„Åï„Çå„Åæ„Åõ„Çì„ÄÇ",
                share_copy: "ÁµêÊûú„Åå„Ç≥„Éî„Éº„Åï„Çå„Åæ„Åó„ÅüÔºÅ",
                share_fail: "„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ",
                share_tpl_title: "[AIR.NW] AI „Åä„Åô„Åô„ÇÅÁµêÊûú",
                share_tpl_link: "„ÇÑ„Å£„Å¶„Åø„Çã",
                share_modal_title: "ÁµêÊûú„ÇíÂÖ±Êúâ",
                share_to_kakao: "KakaoTalk",
                share_to_line: "LINE",
                share_to_tiktok: "TikTok",
                share_to_text: "ÁµêÊûú„Ç≥„Éî„Éº",
                share_to_system: "„Åù„ÅÆ‰ªñ",
                conflict_msg: "„Çπ„ÉÜ„ÉÉ„Éó1„ÅßÈÅ∏Êäû„Åó„ÅüÂ•Ω„Åø„Çø„Ç∞„Åß„Åô„ÄÇ\nËã¶Êâã„Å™„Çø„Ç§„Éó„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÅãÔºü",
                yes: "„ÅØ„ÅÑ",
                no: "„ÅÑ„ÅÑ„Åà",
                main: "„É°„Ç§„É≥",
                ongoing: "ÈÄ£Ëºâ‰∏≠",
                finished: "ÂÆåÁµê",
                login: "„É≠„Ç∞„Ç§„É≥",
                logout: "„É≠„Ç∞„Ç¢„Ç¶„Éà",
                email: "„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ",
                password: "„Éë„Çπ„ÉØ„Éº„Éâ",
                login_btn: "„É≠„Ç∞„Ç§„É≥",
                signup_btn: "Êñ∞Ë¶èÁôªÈå≤",
                auth_title: "„É≠„Ç∞„Ç§„É≥ / Êñ∞Ë¶èÁôªÈå≤",
                like: "„ÅäÊ∞ó„Å´ÂÖ•„Çä",
                my_info: "„Éû„Ç§ÊÉÖÂ†±",
                liked_list: "„ÅäÊ∞ó„Å´ÂÖ•„Çä‰ΩúÂìÅ",
                excluded_list: "Èô§Â§ñ„Åó„Åü‰ΩúÂìÅ",
                delete_account: "‰ºöÂì°ËÑ±ÈÄÄ",
                find_pw: "„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂøò„Çå„ÅüÂ†¥Âêà",
                reset_pw_msg: "„Éë„Çπ„ÉØ„Éº„ÉâÂÜçË®≠ÂÆö„É™„É≥„ÇØ„Çí„É°„Éº„É´„ÅßÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ",
                delete_confirm: "Êú¨ÂΩì„Å´ÈÄÄ‰ºö„Åó„Åæ„Åô„ÅãÔºü\n‰øùÂ≠ò„Åï„Çå„Åü„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÅåÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ",
                no_data: "„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
                password_confirm: "„Éë„Çπ„ÉØ„Éº„ÉâÂÜçÁ¢∫Ë™ç",
                pw_mismatch: "„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì„ÄÇ",
                pw_criteria: "„Éë„Çπ„ÉØ„Éº„Éâ„ÅØ6ÊñáÂ≠ó‰ª•‰∏ä„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                email_invalid: "ÊúâÂäπ„Å™„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                go_to_signup: "„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„Åß„Å™„ÅÑ„Åß„Åô„ÅãÔºü Êñ∞Ë¶èÁôªÈå≤",
                go_to_login: "„Åô„Åß„Å´„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„Åß„Åô„ÅãÔºü „É≠„Ç∞„Ç§„É≥",
                signup_confirm_msg: "Á¢∫Ë™ç„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„ÅüÔºÅ„É°„Éº„É´„Éú„ÉÉ„ÇØ„Çπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                login_error_msg: "„É≠„Ç∞„Ç§„É≥ÊÉÖÂ†±„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
                signup_success: "‰ºöÂì°ÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ",
                worldcup: "„Ç¶„Çß„Éñ„Éà„Ç•„Éº„É≥„ÉØ„Éº„É´„Éâ„Ç´„ÉÉ„Éó",
                worldcup_title: "„Ç¶„Çß„Éñ„Éà„Ç•„Éº„É≥ÁêÜÊÉ≥Âûã„ÉØ„Éº„É´„Éâ„Ç´„ÉÉ„Éó",
                worldcup_select_round: "„É©„Ç¶„É≥„ÉâÈÅ∏Êäû",
                worldcup_start: "„Çπ„Çø„Éº„Éà",
                worldcup_vs: "VS",
                worldcup_round: "Âº∑",
                worldcup_final: "Ê±∫Âãù",
                worldcup_winner: "ÂÑ™Âãù",
                worldcup_result: "„ÉØ„Éº„É´„Éâ„Ç´„ÉÉ„ÉóÁµêÊûú",
                worldcup_history: "„ÉØ„Éº„É´„Éâ„Ç´„ÉÉ„ÉóË®òÈå≤",
                exclude_from_reco: "Êé®Ëñ¶Èô§Â§ñ",
                exclude_from_reco_desc: "Â•Ω„Åø„Å´ÂΩ±Èüø„Åô„Çã„ÅåÊé®Ëñ¶ÁµêÊûú„Åã„Çâ„ÅØÈô§Â§ñ„Åï„Çå„Åæ„Åô",
                today_visitors: "‰ªäÊó•",
                total_visitors: "Á¥ØË®à"
            }
        };

        const getGenreCategories = (t) => [
            { name: t.cat_status, genres: ["Ïó∞Ïû¨Ï§ë", "ÏôÑÍ≤∞"], en: ["Ongoing", "Finished"], zh: ["ËøûËΩΩ‰∏≠", "Â∑≤ÂÆåÁªì"], ja: ["ÈÄ£Ëºâ‰∏≠", "ÂÆåÁµê"] },
            {
                name: t.cat_genre,
                genres: ["Î°úÎß®Ïä§", "ÌåêÌÉÄÏßÄ", "Ïï°ÏÖò", "ÎìúÎùºÎßà", "Ïä§Î¶¥Îü¨", "Î¨¥Ìòë/ÏÇ¨Í∑π", "Í∞úÍ∑∏", "ÏùºÏÉÅ", "Í∞êÏÑ±", "Ïä§Ìè¨Ï∏†"],
                en: ["Romance", "Fantasy", "Action", "Drama", "Thriller", "Martial Arts", "Comedy", "Life", "Sensibility", "Sports"],
                zh: ["Êµ™Êº´", "Â•áÂπª", "Âä®‰Ωú", "ÂâßÊÉÖ", "ÊÉäÊÇö", "Ê≠¶‰æ†/Âè≤Ââß", "ÊêûÁ¨ë", "Êó•Â∏∏", "ÊÑüÊÄß", "‰ΩìËÇ≤"],
                ja: ["„É≠„Éû„É≥„Çπ", "„Éï„Ç°„É≥„Çø„Ç∏„Éº", "„Ç¢„ÇØ„Ç∑„Éß„É≥", "„Éâ„É©„Éû", "„Çπ„É™„É©„Éº", "Ê≠¶‰æ†/ÊôÇ‰ª£Âäá", "„ÇÆ„É£„Ç∞", "Êó•Â∏∏", "ÊÑüÏÑ±", "Ïä§Ìè¨Ï∏†"]
            },
            {
                name: t.cat_topic,
                genres: ["ÌöåÍ∑Ä", "ÎπôÏùò", "Î®ºÏπòÌÇ®", "ÏïÑÏù¥Îèå", "Í≤åÏûÑÌåêÌÉÄÏßÄ", "Î≥µÏàò", "ÌïôÏõêÎ¨º", "Ïò§ÌîºÏä§", "Î°úÌåê", "Ïù¥ÏÑ∏Í≥Ñ"],
                en: ["Regression", "Possession", "Munchkin", "Idol", "Game Fantasy", "Revenge", "School", "Office", "Rom-Fantasy", "Isekai"],
                zh: ["ÂõûÂΩí", "ÈôÑË∫´", "ÈæôÂÇ≤Â§©", "ÂÅ∂ÂÉè", "Ê∏∏ÊàèÂ•áÂπª", "Â§ç‰ªá", "Ê†°Âõ≠", "ËÅåÂú∫", "ÁΩóÊõºÂ•áÂπª", "ÂºÇ‰∏ñÁïå"],
                ja: ["ÂõûÂ∏∞", "ÊÜë‰æù", "ÊúÄÂº∑", "„Ç¢„Ç§„Éâ„É´", "Í≤åÏûÑÌåêÌÉÄÏßÄ", "Âæ©ËÆê", "Â≠¶Âúí„ÇÇ„ÅÆ", "„Ç™„Éï„Ç£„Çπ", "Î°úÌåê", "Áï∞‰∏ñÁïå"]
            },
            {
                name: t.cat_feature,
                genres: ["ÏÇ¨Ïù¥Îã§", "ÌûêÎßÅ", "ÏÑ±Ïû•Î¨º", "ÎëêÎáåÏã∏ÏõÄ", "ÏÑúÏä§ÌéúÏä§"],
                en: ["Satisfying", "Healing", "Growth", "Brain Battle", "Suspense"],
                zh: ["ÁàΩÊñá", "Ê≤ªÊÑà", "ÊàêÈïø", "ËÑëÂäõÊàò", "ÊÇ¨Áñë"],
                ja: ["„Çπ„Ç´„ÉÉ„Å®", "„Éí„Éº„É™„É≥„Ç∞", "ÊàêÈï∑„ÇÇ„ÅÆ", "È†≠ËÑ≥Êà¶", "„Çµ„Çπ„Éö„É≥„Çπ"]
            }
        ];

        const MOCK_WEBTOONS = [
            { id: "641253", title: "Ïô∏Î™®ÏßÄÏÉÅÏ£ºÏùò", tags: ["ÏóêÌîºÏÜåÎìú", "Ïï°ÏÖò", "Î∞ïÌÉúÏ§Ä", "Í∏àÏöîÏõπÌà∞"], thumbnail: "https://image-comic.pstatic.net/webtoon/641253/thumbnail/thumbnail_IMAG21_d894f11f-668a-4046-8692-730a961f7743.jpg", match: 98, status: 'ONGOING' },
            { id: "183559", title: "Ïã†Ïùò ÌÉë", tags: ["ÌåêÌÉÄÏßÄ", "Î®ºÏπòÌÇ®", "Ïû•ÎåÄÌïúÏÑúÏÇ¨"], thumbnail: "https://image-comic.pstatic.net/webtoon/183559/thumbnail/thumbnail_IMAG21_56133031-69f8-45a7-96a9-858348b4e720.jpg", match: 96, status: 'ONGOING' }
        ];

        const ProgressBar = ({ step, t }) => (
            <div className="mb-10 max-w-2xl mx-auto px-6">
                <div className="h-2 w-full bg-gray-200 rounded-full overflow-hidden">
                    <div className="h-full bg-primary transition-all duration-700 ease-out" style={{ width: `${(step / 4) * 100}%` }}></div>
                </div>
                <div className="mt-4 flex justify-between text-[11px] font-bold text-gray-400 uppercase tracking-widest">
                    <span>{t.process}</span>
                    <span className="text-primary">{t.step} {step} {t.of} 4</span>
                </div>
            </div>
        );

        const WebtoonCard = ({ item, rank, onDislike, onLike, isLiked, isDisliked, t }) => {
            const getRankDisplay = (r) => {
                if (r === 1) return <span className="text-lg mr-1.5 shadow-sm">ü•á</span>;
                if (r === 2) return <span className="text-lg mr-1.5 shadow-sm">ü•à</span>;
                if (r === 3) return <span className="text-lg mr-1.5 shadow-sm">ü•â</span>;
                return <span className="text-base font-black text-gray-300 mr-2 italic">{r}</span>;
            };
            return (
                <div className="bg-white rounded-[32px] overflow-hidden shadow-soft hover:shadow-xl transition-all duration-500 transform hover:-translate-y-2 flex flex-col relative group border border-gray-50 h-full">

                    <div className="relative aspect-[3/4] overflow-hidden bg-gray-100">
                        <img src={item.thumbnail} referrerPolicy="no-referrer" className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" onError={(e) => { e.target.src = "https://via.placeholder.com/400?text=No Image"; }} />
                        <div className="absolute bottom-1 right-1 z-20 bg-primary/95 text-white text-[10px] font-bold px-2 py-0.5 rounded-lg shadow-md backdrop-blur-sm">{Math.floor(item.match)}%</div>
                    </div>
                    <div className="p-5 flex flex-col flex-grow">
                        <div className="flex flex-wrap gap-1.5 mb-3 h-[5.2rem] content-start overflow-hidden">
                            {(() => {
                                const rawTags = (item.tags || []);
                                const filteredTags = [];
                                for (const tag of rawTags) {
                                    const isRedundant = filteredTags.some(existing =>
                                        tag.includes(existing) || existing.includes(tag)
                                    );
                                    if (!isRedundant) { filteredTags.push(tag); }
                                }
                                return filteredTags.slice(0, 6).map((tag, idx) => (
                                    <span key={idx} className="text-[11px] font-bold text-primary bg-orange-50 px-2 py-0.5 rounded-md tracking-tighter">#{tag}</span>
                                ));
                            })()}
                        </div>
                        <div className="flex items-center mb-4 h-[2.6rem]">
                            <div className="flex-shrink-0 flex items-center">{getRankDisplay(rank)}</div>
                            <h3 className="text-sm font-extrabold text-gray-900 leading-tight line-clamp-2 break-keep tracking-tighter">{item.title}</h3>
                        </div>
                        <div className="mt-auto w-full">
                            <div className="flex items-center justify-between mb-4">
                                {item.starScore && <div className="text-[10px] font-bold text-yellow-500">‚òÖ {item.starScore.toFixed(2)}</div>}
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => onLike(item.id)}
                                        className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${isLiked ? 'bg-primary text-white shadow-md' : 'bg-gray-50 text-gray-300 hover:text-primary'}`}
                                    >
                                        <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"></path></svg>
                                    </button>
                                    <button
                                        onClick={() => onDislike(item.id)}
                                        className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${isDisliked ? 'bg-red-500 text-white shadow-md' : 'bg-gray-50 text-gray-300 hover:text-red-500'}`}
                                    >
                                        <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"></path></svg>
                                    </button>
                                </div>
                            </div>
                            <a href={`https://comic.naver.com/webtoon/list?titleId=${item.id}`} target="_blank" className="block w-full py-3 bg-primary text-white text-center rounded-xl font-bold hover:opacity-90 transition-all text-[16px] flex items-center justify-center gap-1 shadow-sm">
                                <span>{t.view_now}</span>
                                <span className="text-[10px] opacity-80 font-medium translate-y-[1px]">({item.status === 'FINISHED' ? t.finished : t.ongoing})</span>
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        const ShareModal = ({ isOpen, onClose, t, results }) => {
            useEffect(() => {
                if (isOpen) {
                    document.body.classList.add('modal-open');
                    initKakao();
                } else { document.body.classList.remove('modal-open'); }
                return () => document.body.classList.remove('modal-open');
            }, [isOpen]);

            if (!isOpen) return null;

            const shareUrl = window.location.href;
            const fullRankText = results.map((w, i) => `${i + 1}. ${w.title} (${w.status === 'FINISHED' ? t.finished : t.ongoing})`).join('\n');
            const shareText = `${t.share_tpl_title}\n\n${fullRankText}\n\nüîó ${t.share_tpl_link}: ${shareUrl}`;

            const copyToClip = () => {
                const el = document.createElement('textarea');
                el.value = shareText;
                document.body.appendChild(el);
                el.select();
                try { document.execCommand('copy'); alert(t.share_copy); } catch (e) { alert(t.share_fail); }
                document.body.removeChild(el);
                onClose();
            };

            const shareToKakao = () => {
                if (window.Kakao && Kakao.isInitialized()) {
                    try {
                        Kakao.Share.sendDefault({
                            objectType: 'feed',
                            content: {
                                title: t.share_tpl_title,
                                description: results.slice(0, 3).map(w => w.title).join(', ') + ' Îì± Ï∂îÏ≤úÎê®',
                                imageUrl: results[0]?.thumbnail || 'https://comic.naver.com/static/img/common/naver_shared.png',
                                link: { mobileWebUrl: shareUrl, webUrl: shareUrl },
                            },
                            buttons: [{ title: t.share_tpl_link, link: { mobileWebUrl: shareUrl, webUrl: shareUrl } }],
                        });
                        return;
                    } catch (e) { console.error(e); }
                }
                if (navigator.share) { navigator.share({ title: t.share_tpl_title, text: shareText, url: shareUrl }).catch(() => { }); }
                else copyToClip();
            };

            const shareToLine = () => { window.open(`https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`, '_blank'); };

            return (
                <div className="fixed inset-0 z-[99999] flex items-center justify-center p-6 bg-black/50 backdrop-blur-md" onClick={onClose}>
                    <div className="bg-white w-full max-w-sm rounded-[56px] shadow-2xl overflow-hidden animate-up" onClick={e => e.stopPropagation()}>
                        <div className="pt-12 pb-10 px-8">
                            <h3 className="text-2xl font-black text-center mb-10 tracking-tight">{t.share_modal_title}</h3>
                            <div className="grid grid-cols-2 gap-4 mb-8">
                                <button onClick={shareToKakao} className="premium-gray-btn flex flex-col items-center gap-4 p-8 rounded-[36px]">
                                    <div className="w-16 h-16 flex items-center justify-center bg-[#FEE500] rounded-[24px] shadow-sm overflow-hidden"><img src="https://upload.wikimedia.org/wikipedia/commons/e/e3/KakaoTalk_logo.svg" className="w-10 h-10 object-contain" alt="Kakao" /></div>
                                    <span className="text-sm font-black text-gray-700">{t.share_to_kakao}</span>
                                </button>
                                <button onClick={shareToLine} className="premium-gray-btn flex flex-col items-center gap-4 p-8 rounded-[36px]">
                                    <div className="w-16 h-16 flex items-center justify-center bg-[#06C755] rounded-[22px] shadow-sm overflow-hidden"><img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" className="w-10 h-10 object-contain" alt="LINE" /></div>
                                    <span className="text-sm font-black text-gray-700">{t.share_to_line}</span>
                                </button>
                                <button onClick={copyToClip} className="premium-gray-btn flex flex-col items-center gap-4 p-8 rounded-[36px]">
                                    <div className="w-16 h-16 flex items-center justify-center bg-black rounded-[22px] shadow-sm overflow-hidden"><img src="https://www.logo.wine/a/logo/TikTok/TikTok-Icon-Logo.wine.svg" className="w-[85%] h-[85%] object-contain" alt="TikTok" style={{ filter: 'brightness(1.5)' }} /></div>
                                    <span className="text-sm font-black text-gray-700">{t.share_to_tiktok}</span>
                                </button>
                                <button onClick={copyToClip} className="premium-gray-btn flex flex-col items-center gap-4 p-8 rounded-[36px]">
                                    <div className="w-16 h-16 flex items-center justify-center bg-slate-200 rounded-[22px] shadow-sm overflow-hidden text-slate-600"><svg viewBox="0 0 24 24" className="w-8 h-8 fill-current"><path d="M7 6V3C7 2.44772 7.44772 2 8 2H20C20.5523 2 21 2.44772 21 3V17C21 17.5523 20.5523 18 20 18H17V21C17 21.5523 16.5523 22 16 22H4C3.44772 22 3 21.5523 3 21V7C3 6.44772 3.44772 6 4 6H7ZM9 6H16V16H17V4H9V6ZM5 8V20H15V8H5Z"></path></svg></div>
                                    <span className="text-sm font-black text-gray-700">{t.share_to_text}</span>
                                </button>
                            </div>
                            <button onClick={onClose} className="w-full py-5 bg-gray-50 rounded-2xl text-gray-400 font-black">CLOSE</button>
                        </div>
                    </div>
                </div>
            );
        };

        const WorldcupModal = ({ isOpen, onClose, t, user, onSaveResult }) => {
            const [stage, setStage] = useState('select'); // 'select', 'playing', 'result'
            const [selectedRound, setSelectedRound] = useState(16);
            const [matches, setMatches] = useState([]);
            const [currentMatchIndex, setCurrentMatchIndex] = useState(0);
            const [winners, setWinners] = useState([]);
            const [finalWinner, setFinalWinner] = useState(null);

            useEffect(() => {
                if (isOpen) {
                    document.body.classList.add('modal-open');
                } else {
                    document.body.classList.remove('modal-open');
                    // Reset on close
                    setStage('select');
                    setMatches([]);
                    setCurrentMatchIndex(0);
                    setWinners([]);
                    setFinalWinner(null);
                }
                return () => document.body.classList.remove('modal-open');
            }, [isOpen]);

            if (!isOpen) return null;

            const startWorldcup = () => {
                const rawData = window.WEBTOON_DATA || [];
                if (rawData.length < selectedRound) {
                    alert(`ÏõπÌà∞ Îç∞Ïù¥ÌÑ∞Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§. ÏµúÏÜå ${selectedRound}Í∞ú ÌïÑÏöîÌï©ÎãàÎã§.`);
                    return;
                }

                // Shuffle and select webtoons
                const shuffled = [...rawData].sort(() => Math.random() - 0.5);
                const selected = shuffled.slice(0, selectedRound);

                // Create initial matches
                const initialMatches = [];
                for (let i = 0; i < selected.length; i += 2) {
                    initialMatches.push([selected[i], selected[i + 1]]);
                }

                setMatches(initialMatches);
                setCurrentMatchIndex(0);
                setWinners([]);
                setStage('playing');
            };

            const selectWinner = (webtoon) => {
                const newWinners = [...winners, webtoon];

                if (currentMatchIndex + 1 < matches.length) {
                    // Move to next match
                    setCurrentMatchIndex(currentMatchIndex + 1);
                    setWinners(newWinners);
                } else {
                    // Round complete
                    if (newWinners.length === 1) {
                        // Tournament complete!
                        setFinalWinner(newWinners[0]);
                        setStage('result');
                        saveWorldcupResult(newWinners[0], selectedRound);
                    } else {
                        // Start next round
                        const nextMatches = [];
                        for (let i = 0; i < newWinners.length; i += 2) {
                            nextMatches.push([newWinners[i], newWinners[i + 1]]);
                        }
                        setMatches(nextMatches);
                        setCurrentMatchIndex(0);
                        setWinners([]);
                    }
                }
            };

            const saveWorldcupResult = async (winner, round) => {
                if (!user) return;

                const result = {
                    user_id: user.id,
                    winner_id: winner.titleId || winner.id,
                    winner_title: winner.titleName || winner.title,
                    round: round,
                    created_at: new Date().toISOString()
                };

                await supabase.from('worldcup_results').insert(result);
                if (onSaveResult) onSaveResult(result);
            };

            const getCurrentRound = () => {
                const remaining = matches.length * 2;
                if (remaining === 2) return t.worldcup_final;
                return `${remaining}${t.worldcup_round}`;
            };

            const currentMatch = matches[currentMatchIndex];

            return (
                <div className="fixed inset-0 z-[99999] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md" onClick={onClose}>
                    <div className="bg-white w-full max-w-xl rounded-[28px] shadow-2xl overflow-hidden animate-up max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                        {stage === 'select' && (
                            <div className="p-6">
                                <h2 className="text-xl font-black text-center mb-4 tracking-tight">{t.worldcup_title}</h2>
                                <p className="text-center text-gray-500 mb-6 font-medium text-sm">{t.worldcup_select_round}</p>
                                <div className="grid grid-cols-4 gap-2 mb-6">
                                    {[16, 32, 64, 128, 256, 512, 1024, 2048].map(round => (
                                        <button
                                            key={round}
                                            onClick={() => setSelectedRound(round)}
                                            className={`py-3 px-2 rounded-xl font-bold text-sm transition-all ${selectedRound === round
                                                ? 'bg-primary text-white shadow-lg scale-105'
                                                : 'bg-gray-50 text-gray-400 hover:bg-gray-100'
                                                }`}
                                        >
                                            {round}{t.worldcup_round}
                                        </button>
                                    ))}
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={onClose} className="flex-1 py-3 bg-gray-100 text-gray-500 font-bold rounded-xl text-sm">Îã´Í∏∞</button>
                                    <button onClick={startWorldcup} className="flex-[2] py-3 bg-primary text-white font-black rounded-xl shadow-lg text-sm">{t.worldcup_start}</button>
                                </div>
                            </div>
                        )}

                        {stage === 'playing' && currentMatch && (
                            <div className="p-4">
                                <div className="text-center mb-4">
                                    <h3 className="text-lg font-black mb-1">{getCurrentRound()}</h3>
                                    <p className="text-gray-400 font-medium text-sm">{currentMatchIndex + 1} / {matches.length}</p>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    {currentMatch.map((webtoon, idx) => (
                                        <>
                                            <button
                                                key={idx}
                                                onClick={() => selectWinner(webtoon)}
                                                className="group relative bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border border-gray-100 hover:border-primary"
                                            >
                                                <div className="aspect-[3/4] overflow-hidden bg-gray-100">
                                                    <img
                                                        src={webtoon.thumbnailUrl || webtoon.thumbnail}
                                                        referrerPolicy="no-referrer"
                                                        className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                                                        onError={(e) => { e.target.src = "https://via.placeholder.com/400?text=No Image"; }}
                                                    />
                                                </div>
                                                <div className="p-3 bg-gradient-to-t from-white to-transparent">
                                                    <h4 className="text-xs font-black text-gray-900 line-clamp-2 mb-1">{webtoon.titleName || webtoon.title}</h4>
                                                    <div className="flex flex-wrap gap-0.5">
                                                        {(webtoon.tags || []).slice(0, 2).map((tag, i) => (
                                                            <span key={i} className="text-[8px] font-bold text-primary bg-orange-50 px-1.5 py-0.5 rounded">#{tag}</span>
                                                        ))}
                                                    </div>
                                                </div>
                                            </button>
                                            {idx === 0 && <div className="hidden md:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10"><span className="text-2xl font-black text-primary bg-white px-4 py-2 rounded-xl shadow-lg">{t.worldcup_vs}</span></div>}
                                        </>
                                    ))}
                                </div>
                                <div className="text-center my-3"><span className="text-2xl font-black text-primary">{t.worldcup_vs}</span></div>
                            </div>
                        )}

                        {stage === 'result' && finalWinner && (
                            <div className="p-6 text-center">
                                <div className="text-4xl mb-4">üèÜ</div>
                                <h2 className="text-xl font-black mb-3">{t.worldcup_winner}</h2>
                                <div className="max-w-[200px] mx-auto mb-6">
                                    <div className="bg-white rounded-2xl overflow-hidden shadow-lg border-2 border-primary">
                                        <div className="aspect-[3/4] overflow-hidden bg-gray-100">
                                            <img
                                                src={finalWinner.thumbnailUrl || finalWinner.thumbnail}
                                                referrerPolicy="no-referrer"
                                                className="w-full h-full object-cover"
                                                onError={(e) => { e.target.src = "https://via.placeholder.com/400?text=No Image"; }}
                                            />
                                        </div>
                                        <div className="p-4">
                                            <h3 className="text-base font-black text-gray-900 mb-2">{finalWinner.titleName || finalWinner.title}</h3>
                                            <p className="text-xs text-gray-500 font-medium">{selectedRound}{t.worldcup_round} {t.worldcup_winner}</p>
                                        </div>
                                    </div>
                                </div>
                                <button onClick={onClose} className="px-10 py-3 bg-primary text-white font-black rounded-xl shadow-lg hover:scale-105 transition-transform text-sm">ÏôÑÎ£å</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [lang, setLang] = useState('ko');
            const [step, setStep] = useState(1);
            const [selectedG, setSelectedG] = useState([]);
            const [excludedG, setExcludedG] = useState([]); // Non-preferred tastes
            const [favTitle, setFavTitle] = useState("");
            const [loading, setLoading] = useState(false);
            const [results, setResults] = useState([]);
            const [scoredPool, setScoredPool] = useState([]);
            const [dislikedIds, setDislikedIds] = useState(() => {
                try { return JSON.parse(localStorage.getItem('excludedWebtoons')) || []; } catch (e) { return []; }
            });
            const [showExcludePopup, setShowExcludePopup] = useState(false);
            const [showShareModal, setShowShareModal] = useState(false);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [showProfileModal, setShowProfileModal] = useState(false);
            const [user, setUser] = useState(null);
            const [likedIds, setLikedIds] = useState([]);
            const [conflictTag, setConflictTag] = useState(null); // Tag causing conflict
            const [profileTab, setProfileTab] = useState('liked'); // 'liked' or 'excluded'
            const [authMode, setAuthMode] = useState('login'); // 'login' or 'signup'
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [showWorldcupModal, setShowWorldcupModal] = useState(false);
            const [worldcupRound, setWorldcupRound] = useState(16);
            const [worldcupMatches, setWorldcupMatches] = useState([]);
            const [worldcupCurrentMatch, setWorldcupCurrentMatch] = useState(0);
            const [worldcupWinners, setWorldcupWinners] = useState([]);
            const [worldcupHistory, setWorldcupHistory] = useState([]);
            const [excludedFromRecoIds, setExcludedFromRecoIds] = useState([]);
            const [todayVisitors, setTodayVisitors] = useState(0);
            const [totalVisitors, setTotalVisitors] = useState(0);

            const t = TRANSLATIONS[lang] || TRANSLATIONS.ko;

            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    if (session) { setUser(session.user); loadUserData(session.user.id); }
                });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    if (session) { setUser(session.user); loadUserData(session.user.id); }
                    else { setUser(null); setLikedIds([]); setDislikedIds([]); }
                });

                // Handle Signup Success Redirect
                if (window.location.hash.includes('type=signup')) {
                    alert(t.signup_success);
                    // Clear hash to avoid repeated alerts
                    window.history.replaceState(null, null, window.location.pathname);
                }

                return () => subscription.unsubscribe();
            }, [t]);

            // Visitor Counter Effect
            useEffect(() => {
                const trackVisitor = async () => {
                    const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
                    const visitorKey = `visited_${today}`;

                    // Check if already visited today
                    if (!localStorage.getItem(visitorKey)) {
                        localStorage.setItem(visitorKey, 'true');

                        // Increment visitor count in Supabase
                        await supabase.rpc('increment_visitor', { visit_date: today });
                    }

                    // Fetch visitor counts
                    const { data: todayData } = await supabase
                        .from('visitor_stats')
                        .select('count')
                        .eq('date', today)
                        .single();

                    const { data: totalData } = await supabase
                        .from('visitor_stats')
                        .select('count');

                    if (todayData) setTodayVisitors(todayData.count || 0);
                    if (totalData) setTotalVisitors(totalData.reduce((sum, row) => sum + (row.count || 0), 0));
                };

                trackVisitor();
            }, []);

            const loadUserData = async (userId) => {
                const { data: exData } = await supabase.from('excluded_webtoons').select('webtoon_id').eq('user_id', userId);
                if (exData) setDislikedIds(exData.map(d => d.webtoon_id));
                const { data: favData } = await supabase.from('favorite_webtoons').select('webtoon_id').eq('user_id', userId);
                if (favData) setLikedIds(favData.map(d => d.webtoon_id));

                // Load worldcup history
                const { data: wcData } = await supabase.from('worldcup_results').select('*').eq('user_id', userId).order('created_at', { ascending: false });
                if (wcData) setWorldcupHistory(wcData);

                // Load excluded from recommendations
                const { data: exRecoData } = await supabase.from('excluded_from_recommendations').select('webtoon_id').eq('user_id', userId);
                if (exRecoData) setExcludedFromRecoIds(exRecoData.map(d => d.webtoon_id));
            };

            const toggleLike = async (id) => {
                if (!user) { setShowAuthModal(true); return; }
                const isLiked = likedIds.includes(id);
                if (isLiked) {
                    await supabase.from('favorite_webtoons').delete().eq('user_id', user.id).eq('webtoon_id', id);
                    setLikedIds(prev => prev.filter(it => it !== id));
                } else {
                    // Remove from dislikes if it was disliked
                    if (dislikedIds.includes(id)) toggleDislike(id);
                    await supabase.from('favorite_webtoons').insert({ user_id: user.id, webtoon_id: id });
                    setLikedIds(prev => [...prev, id]);
                }
            };

            const handleExclude = async (id) => {
                const newEx = [...dislikedIds, id];
                setDislikedIds(newEx);
                localStorage.setItem('excludedWebtoons', JSON.stringify(newEx));
                if (user) { await supabase.from('excluded_webtoons').upsert({ user_id: user.id, webtoon_id: id }); }
                setResults(scoredPool.filter(x => !newEx.includes(x.id)).slice(0, 10));
                setShowExcludePopup(true);
                setTimeout(() => setShowExcludePopup(false), 2000);
            };
            const categories = useMemo(() => getGenreCategories(t), [t]);

            const nextStep = () => { setStep(prev => prev + 1); window.scrollTo({ top: 0, behavior: 'smooth' }); };
            const prevStep = () => { setStep(prev => prev - 1); window.scrollTo({ top: 0, behavior: 'smooth' }); };
            const reset = () => { setStep(1); setSelectedG([]); setExcludedG([]); setFavTitle(""); setScoredPool([]); window.scrollTo({ top: 0, behavior: 'smooth' }); };

            const handleAnalyze = async () => {
                setLoading(true); setStep(4);
                window.scrollTo({ top: 0, behavior: 'smooth' });
                await new Promise(r => setTimeout(r, 1500));
                const rawData = window.WEBTOON_DATA || MOCK_WEBTOONS;
                const statusFilters = selectedG.filter(s => ["Ïó∞Ïû¨Ï§ë", "ÏôÑÍ≤∞"].includes(s));
                const genrePreferences = selectedG.filter(s => !["Ïó∞Ïû¨Ï§ë", "ÏôÑÍ≤∞"].includes(s));

                // Similarity scoring based on liked webtoons
                const likedWebtoons = rawData.filter(w => likedIds.includes(w.titleId || w.id));
                const preferredLegacyTags = likedWebtoons.reduce((acc, curr) => [...acc, ...(curr.tags || [])], []);

                // Get worldcup winners for bonus scoring
                const worldcupWinnerIds = worldcupHistory.map(h => h.winner_id);

                const scoredData = rawData.map(item => {
                    const webtoon = {
                        id: item.titleId || item.id,
                        title: item.titleName || item.title,
                        thumbnail: item.thumbnailUrl || item.thumbnail,
                        tags: (item.tags && item.tags.length > 0) ? item.tags : [item.day, item.status === 'FINISHED' ? t.finished : t.ongoing, item.author].filter(Boolean),
                        author: item.author,
                        status: item.status,
                        starScore: item.starScore || 0,
                        viewCount: item.viewCount || 0
                    };

                    if (dislikedIds.includes(webtoon.id)) return { ...webtoon, match: 0 };
                    if (excludedG.length > 0) {
                        const hasExcludedTag = excludedG.some(ex =>
                            webtoon.tags.some(t => String(t).includes(ex)) || webtoon.title.includes(ex)
                        );
                        if (hasExcludedTag) return { ...webtoon, match: 0 };
                    }

                    let score = 50;
                    if (statusFilters.length > 0) {
                        const myStatus = webtoon.status === 'FINISHED' ? 'ÏôÑÍ≤∞' : 'Ïó∞Ïû¨Ï§ë';
                        if (!statusFilters.includes(myStatus)) return { ...webtoon, match: 0 };
                    }
                    genrePreferences.forEach(pref => {
                        const keywords = pref.includes('/') ? pref.split('/') : [pref];
                        if (keywords.some(k => webtoon.tags.some(t => String(t).includes(k)) || webtoon.title.includes(k))) score += 20;
                    });

                    // Bonus for similarity to liked webtoons
                    if (preferredLegacyTags.length > 0) {
                        const overlap = webtoon.tags.filter(tag => preferredLegacyTags.includes(tag)).length;
                        score += (overlap * 5);
                    }

                    // Bonus for worldcup winners
                    if (worldcupWinnerIds.includes(webtoon.id)) {
                        score += 15;
                    }

                    return { ...webtoon, match: Math.min(99, score + (Math.random() * 5)) };
                });

                const sorted = scoredData.filter(w => w.match > 0 && !excludedFromRecoIds.includes(w.id)).sort((a, b) => {
                    let scoreA = a.match;
                    let scoreB = b.match;
                    if (dislikedIds.includes(a.id)) scoreA -= 50;
                    if (dislikedIds.includes(b.id)) scoreB -= 50;
                    if (scoreB !== scoreA) return scoreB - scoreA;
                    if (b.starScore !== a.starScore) return b.starScore - a.starScore;
                    return b.viewCount - a.viewCount;
                });
                setScoredPool(sorted);
                setResults(sorted.slice(0, 10));
                setLoading(false);
            };

            const toggleDislike = async (id) => {
                if (!user) { setShowAuthModal(true); return; }
                const isDisliked = dislikedIds.includes(id);
                if (isDisliked) {
                    await supabase.from('excluded_webtoons').delete().eq('user_id', user.id).eq('webtoon_id', id);
                    const newDislikedIds = dislikedIds.filter(it => it !== id);
                    setDislikedIds(newDislikedIds);
                    localStorage.setItem('excludedWebtoons', JSON.stringify(newDislikedIds));
                } else {
                    // Remove from likes if it was liked
                    if (likedIds.includes(id)) toggleLike(id);
                    await supabase.from('excluded_webtoons').insert({ user_id: user.id, webtoon_id: id });
                    const newDislikedIds = [...dislikedIds, id];
                    setDislikedIds(newDislikedIds);
                    localStorage.setItem('excludedWebtoons', JSON.stringify(newDislikedIds));
                }
            };

            return (
                <div className="min-h-screen pb-20">
                    <header className="sticky top-0 z-[1000] bg-white/90 backdrop-blur-md border-b border-gray-100 py-4 px-4 sm:px-10">
                        <div className="max-w-7xl mx-auto">
                            {/* Mobile Layout */}
                            <div className="md:hidden">
                                <div className="flex items-center justify-center mb-3">
                                    <h1 className="text-lg font-black text-gray-800 tracking-tight italic text-center">{t.subtitle}</h1>
                                </div>
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-1">
                                        {[{ code: 'ko', label: 'KO' }, { code: 'en', label: 'EN' }, { code: 'zh', label: 'ZH' }, { code: 'ja', label: 'JA' }].map(l => (
                                            <button key={l.code} onClick={() => setLang(l.code)}
                                                className={`px-2 py-1.5 rounded-lg border text-[10px] font-black transition-all ${lang === l.code ? 'bg-primary border-primary text-white' : 'bg-white text-gray-300 border-gray-100'}`}>
                                                {l.label}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="flex gap-1.5 items-center ml-auto">
                                        {user ? (
                                            <>
                                                <button onClick={() => setShowWorldcupModal(true)} title={t.worldcup} className="w-9 h-9 flex items-center justify-center bg-yellow-50 text-yellow-600 rounded-xl hover:bg-yellow-100 transition-all">
                                                    <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M20 2H4c-1.1 0-2 .9-2 2v2c0 1.86 1.28 3.41 3 3.86V16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-6.14c1.72-.45 3-2 3-3.86V4c0-1.1-.9-2-2-2zm-2 14H6v-4h12v4zm2-10c0 .55-.45 1-1 1h-2V4h3v2zM4 4h3v3H5c-.55 0-1-.45-1-1V4zm8 11c-2.21 0-4 1.79-4 4h8c0-2.21-1.79-4-4-4z"></path></svg>
                                                </button>
                                                <button onClick={() => setShowProfileModal(true)} title={t.my_info} className="w-9 h-9 flex items-center justify-center bg-gray-50 text-gray-500 rounded-xl hover:bg-primary/10 hover:text-primary transition-all">
                                                    <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>
                                                </button>
                                                <button onClick={() => supabase.auth.signOut()} title={t.logout} className="w-9 h-9 flex items-center justify-center text-gray-400 hover:text-red-500 transition-all">
                                                    <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"></path></svg>
                                                </button>
                                            </>
                                        ) : (
                                            <button onClick={() => setShowAuthModal(true)} title={t.login} className="w-9 h-9 flex items-center justify-center bg-gray-50 text-gray-400 rounded-xl hover:bg-primary/10 hover:text-primary transition-all">
                                                <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>
                                            </button>
                                        )}
                                        {step < 4 ? (
                                            <button onClick={reset} title={t.main} className={`w-9 h-9 flex items-center justify-center rounded-xl border border-gray-100 hover:bg-gray-50 transition-all ${step > 1 ? 'visible' : 'invisible'}`}>
                                                <svg viewBox="0 0 24 24" className="w-4 h-4 fill-gray-400"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
                                            </button>
                                        ) : (
                                            !loading && (
                                                <button onClick={() => setShowShareModal(true)} title={t.share} className="w-9 h-9 flex items-center justify-center bg-primary text-white rounded-xl shadow-md hover:scale-105 transition-transform active:scale-95">
                                                    <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"></path></svg>
                                                </button>
                                            )
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Desktop Layout */}
                            <div className="hidden md:flex items-center justify-between">
                                <div className="flex items-center gap-1">
                                    {[{ code: 'ko', label: 'KO' }, { code: 'en', label: 'EN' }, { code: 'zh', label: 'ZH' }, { code: 'ja', label: 'JA' }].map(l => (
                                        <button key={l.code} onClick={() => setLang(l.code)}
                                            className={`px-2 py-1.5 rounded-lg border text-[10px] font-black transition-all ${lang === l.code ? 'bg-primary border-primary text-white' : 'bg-white text-gray-300 border-gray-100'}`}>
                                            {l.label}
                                        </button>
                                    ))}
                                </div>
                                <h1 className="text-xl font-black text-gray-800 tracking-tight italic">{t.subtitle}</h1>
                                <div className="flex gap-2 items-center">
                                    {user ? (
                                        <>
                                            <button onClick={() => setShowWorldcupModal(true)} title={t.worldcup} className="w-9 h-9 flex items-center justify-center bg-yellow-50 text-yellow-600 rounded-xl hover:bg-yellow-100 transition-all">
                                                <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M20 2H4c-1.1 0-2 .9-2 2v2c0 1.86 1.28 3.41 3 3.86V16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-6.14c1.72-.45 3-2 3-3.86V4c0-1.1-.9-2-2-2zm-2 14H6v-4h12v4zm2-10c0 .55-.45 1-1 1h-2V4h3v2zM4 4h3v3H5c-.55 0-1-.45-1-1V4zm8 11c-2.21 0-4 1.79-4 4h8c0-2.21-1.79-4-4-4z"></path></svg>
                                            </button>
                                            <button onClick={() => setShowProfileModal(true)} title={t.my_info} className="w-9 h-9 flex items-center justify-center bg-gray-50 text-gray-500 rounded-xl hover:bg-primary/10 hover:text-primary transition-all">
                                                <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>
                                            </button>
                                            <button onClick={() => supabase.auth.signOut()} title={t.logout} className="w-9 h-9 flex items-center justify-center text-gray-400 hover:text-red-500 transition-all">
                                                <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"></path></svg>
                                            </button>
                                        </>
                                    ) : (
                                        <button onClick={() => setShowAuthModal(true)} title={t.login} className="w-9 h-9 flex items-center justify-center bg-gray-50 text-gray-400 rounded-xl hover:bg-primary/10 hover:text-primary transition-all">
                                            <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>
                                        </button>
                                    )}
                                    {step < 4 ? (
                                        <button onClick={reset} title={t.main} className={`w-9 h-9 flex items-center justify-center rounded-xl border border-gray-100 hover:bg-gray-50 transition-all ${step > 1 ? 'visible' : 'invisible'}`}>
                                            <svg viewBox="0 0 24 24" className="w-4 h-4 fill-gray-400"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
                                        </button>
                                    ) : (
                                        !loading && (
                                            <button onClick={() => setShowShareModal(true)} title={t.share} className="w-9 h-9 flex items-center justify-center bg-primary text-white rounded-xl shadow-md hover:scale-105 transition-transform active:scale-95">
                                                <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"></path></svg>
                                            </button>
                                        )
                                    )}
                                </div>
                            </div>
                        </div>
                    </header>
                    <main className="max-w-6xl mx-auto px-6 py-10">
                        <ProgressBar step={step} t={t} />
                        {step === 1 && (
                            <div className="animate-up max-w-4xl mx-auto">
                                <div className="text-center mb-14"><h2 className="text-3xl sm:text-4xl font-black mb-4 tracking-tight">{t.step1_title}</h2><p className="text-gray-600 italic font-bold">{t.step1_desc}</p></div>
                                <div className="space-y-10">{categories.map(cat => (<div key={cat.name} className="space-y-5"><h3 className="text-sm font-black text-gray-600 uppercase tracking-widest px-1">{cat.name}</h3><div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-3">{cat.genres.map((g, idx) => { const label = lang === 'en' ? cat.en[idx] : lang === 'zh' ? cat.zh[idx] : lang === 'ja' ? cat.ja[idx] : g; return (<button key={g} onClick={() => setSelectedG(prev => prev.includes(g) ? prev.filter(it => it !== g) : [...prev, g])} className={`py-4 px-4 rounded-[24px] text-[13px] font-bold border-2 transition-all ${selectedG.includes(g) ? 'bg-primary border-primary text-white shadow-xl scale-[0.98]' : 'bg-white border-gray-100 text-gray-500'}`}>#{label}</button>); })}</div></div>))}</div>
                                <div className="mt-20 text-center"><button disabled={selectedG.length === 0} onClick={nextStep} className="w-full sm:w-auto px-16 py-5 bg-primary text-white font-black rounded-full shadow-2xl disabled:opacity-20 text-lg uppercase tracking-widest">NEXT</button></div>
                            </div>
                        )}
                        {step === 2 && (
                            <div className="animate-up max-w-4xl mx-auto">
                                <div className="text-center mb-14"><h2 className="text-3xl sm:text-4xl font-black mb-4 tracking-tight">{t.step2_title}</h2><p className="text-gray-600 italic font-bold">{t.step2_desc}</p></div>
                                <div className="space-y-10">
                                    {categories.map(cat => (
                                        <div key={cat.name} className="space-y-5">
                                            <h3 className="text-sm font-black text-gray-600 uppercase tracking-widest px-1">{cat.name}</h3>
                                            <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-3">
                                                {cat.genres.map((g, idx) => {
                                                    const label = lang === 'en' ? cat.en[idx] : lang === 'zh' ? cat.zh[idx] : lang === 'ja' ? cat.ja[idx] : g;
                                                    const isPreferred = selectedG.includes(g);
                                                    return (
                                                        <button
                                                            key={g}
                                                            onClick={() => {
                                                                if (isPreferred) {
                                                                    setConflictTag(g);
                                                                } else {
                                                                    setExcludedG(prev => prev.includes(g) ? prev.filter(it => it !== g) : [...prev, g]);
                                                                }
                                                            }}
                                                            className={`py-4 px-4 rounded-[24px] text-[13px] font-bold border-2 transition-all ${excludedG.includes(g) ? 'bg-red-500 border-red-500 text-white shadow-xl scale-[0.98]' : isPreferred ? 'bg-gray-100 border-gray-100 text-gray-300' : 'bg-white border-gray-100 text-gray-500'}`}
                                                        >
                                                            #{label}
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-20 flex gap-4 justify-center"><button onClick={prevStep} className="px-16 py-5 bg-gray-100 text-gray-500 font-bold rounded-full uppercase">BACK</button><button onClick={nextStep} className="px-16 py-5 bg-primary text-white font-black rounded-full shadow-2xl uppercase">CONTINUE</button></div>
                            </div>
                        )}
                        {step === 3 && (
                            <div className="animate-up max-w-2xl mx-auto py-10 px-6">
                                <div className="text-center mb-12">
                                    <h2 className="text-3xl font-black mb-4 tracking-tight">{t.step3_title}</h2>
                                    <p className="text-gray-400 font-medium italic opacity-80 decoration-primary/30 decoration-2">{t.step3_desc || ""}</p>
                                </div>
                                <div className="space-y-8">
                                    <input
                                        type="text"
                                        value={favTitle}
                                        onChange={e => setFavTitle(e.target.value)}
                                        placeholder={t.step3_placeholder}
                                        className="w-full py-5 px-8 rounded-3xl bg-white border-2 border-gray-100 focus:border-primary focus:ring-4 focus:ring-primary/5 outline-none text-center text-lg shadow-sm transition-all font-bold placeholder:text-gray-200"
                                    />
                                    <div className="flex gap-3">
                                        <button onClick={prevStep} className="flex-1 py-4 bg-gray-50 text-gray-400 font-bold rounded-2xl hover:bg-gray-100 transition-all uppercase tracking-widest text-sm">BACK</button>
                                        <button
                                            onClick={handleAnalyze}
                                            className="flex-[2] py-4 bg-primary text-white font-black rounded-2xl shadow-xl hover:shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all uppercase tracking-widest"
                                        >
                                            ANALYZE
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {step === 4 && (
                            <div className="animate-up">{loading ? (<div className="flex flex-col items-center justify-center py-40"><div className="w-16 h-16 border-[8px] border-gray-100 border-t-primary rounded-full animate-spin mb-10"></div><p className="text-gray-300 font-black tracking-widest uppercase animate-pulse">{t.computing}</p></div>) : (<div className="animate-up"><div className="text-center mb-14"><h2 className="text-3xl sm:text-4xl font-black mb-3 italic tracking-tight">{t.result_title}</h2><p className="text-gray-400 font-medium">{t.result_desc}</p></div><div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">{results.map((w, idx) => (<WebtoonCard key={w.id} item={w} rank={idx + 1} onDislike={toggleDislike} onLike={toggleLike} isLiked={likedIds.includes(w.id)} isDisliked={dislikedIds.includes(w.id)} t={t} />))}</div><button onClick={reset} className="mt-24 px-16 py-6 border-2 border-gray-200 text-gray-300 font-black rounded-full hover:border-primary hover:text-primary transition-all uppercase block mx-auto tracking-widest text-sm">NEW SEARCH</button></div>)}</div>
                        )}
                    </main>
                    {showExcludePopup && (<div className="fixed bottom-10 left-1/2 -translate-x-1/2 z-[1000] animate-up"><div className="bg-gray-900/95 backdrop-blur-md text-white px-8 py-4 rounded-3xl shadow-2xl flex items-center gap-3"><span className="text-2xl">üö´</span><p className="font-bold text-sm tracking-tight">{t.exclude_msg}</p></div></div>)}

                    {/* Conflict Confirmation Modal */}
                    {
                        conflictTag && (
                            <div className="fixed inset-0 z-[110000] flex items-center justify-center p-6 bg-black/40 backdrop-blur-sm">
                                <div className="bg-white w-full max-w-xs rounded-[40px] shadow-2xl overflow-hidden animate-up p-8 text-center">
                                    <span className="text-3xl mb-4 block">‚ö†Ô∏è</span>
                                    <p className="text-gray-800 font-bold text-sm leading-relaxed mb-8 whitespace-pre-wrap">{t.conflict_msg}</p>
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => {
                                                setSelectedG(prev => prev.filter(it => it !== conflictTag));
                                                setExcludedG(prev => [...prev, conflictTag]);
                                                setConflictTag(null);
                                            }}
                                            className="flex-1 py-4 bg-primary text-white font-black rounded-2xl shadow-lg active:scale-95 transition-transform"
                                        >
                                            {t.yes}
                                        </button>
                                        <button
                                            onClick={() => setConflictTag(null)}
                                            className="flex-1 py-4 bg-gray-100 text-gray-500 font-bold rounded-2xl active:scale-95 transition-transform"
                                        >
                                            {t.no}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )
                    }

                    <ShareModal isOpen={showShareModal} onClose={() => setShowShareModal(false)} t={t} results={results} />

                    <WorldcupModal
                        isOpen={showWorldcupModal}
                        onClose={() => setShowWorldcupModal(false)}
                        t={t}
                        user={user}
                        onSaveResult={(result) => setWorldcupHistory(prev => [result, ...prev])}
                    />

                    {/* Authentication Modal */}
                    {/* Authentication Modal */}
                    {
                        showAuthModal && (
                            <div className="fixed inset-0 z-[120000] flex items-center justify-center p-6 bg-black/50 backdrop-blur-md" onClick={() => { setShowAuthModal(false); setAuthMode('login'); setEmail(''); setPassword(''); setConfirmPassword(''); }}>
                                <div className="bg-white w-full max-w-sm rounded-[48px] shadow-2xl overflow-hidden animate-up p-10 flex flex-col items-center" onClick={e => e.stopPropagation()}>
                                    <h3 className="text-2xl font-black mb-8 tracking-tighter">{authMode === 'login' ? t.login : t.signup_btn}</h3>
                                    <div className="w-full space-y-4">
                                        <div className="flex flex-col gap-3">
                                            <input
                                                type="email"
                                                value={email}
                                                onChange={e => setEmail(e.target.value)}
                                                placeholder={t.email}
                                                className="px-6 py-4 rounded-2xl bg-gray-50 border border-gray-100 outline-none focus:border-primary font-bold text-sm"
                                            />
                                            <input
                                                type="password"
                                                value={password}
                                                onChange={e => setPassword(e.target.value)}
                                                placeholder={t.password}
                                                className="px-6 py-4 rounded-2xl bg-gray-50 border border-gray-100 outline-none focus:border-primary font-bold text-sm"
                                            />
                                            {authMode === 'signup' && (
                                                <>
                                                    <input
                                                        type="password"
                                                        value={confirmPassword}
                                                        onChange={e => setConfirmPassword(e.target.value)}
                                                        placeholder={t.password_confirm}
                                                        className="px-6 py-4 rounded-2xl bg-gray-50 border border-gray-100 outline-none focus:border-primary font-bold text-sm"
                                                    />
                                                    {password && password.length < 6 && <p className="text-[10px] font-bold text-red-500 px-2">{t.pw_criteria}</p>}
                                                    {confirmPassword && password !== confirmPassword && <p className="text-[10px] font-bold text-red-500 px-2">{t.pw_mismatch}</p>}
                                                </>
                                            )}
                                        </div>

                                        {authMode === 'login' ? (
                                            <div className="flex flex-col gap-4">
                                                <button
                                                    onClick={async () => {
                                                        const { error } = await supabase.auth.signInWithPassword({ email, password });
                                                        if (error) alert(t.login_error_msg || error.message); else setShowAuthModal(false);
                                                    }}
                                                    className="w-full py-4 bg-primary text-white font-black rounded-2xl shadow-lg active:scale-95 transition-transform"
                                                >
                                                    {t.login_btn}
                                                </button>
                                                <button
                                                    onClick={() => setAuthMode('signup')}
                                                    className="text-center text-[11px] font-bold text-gray-400 hover:text-primary transition-colors"
                                                >
                                                    {t.go_to_signup}
                                                </button>
                                                <button
                                                    onClick={async () => {
                                                        if (!email) { alert("Please enter your email first"); return; }
                                                        const { error } = await supabase.auth.resetPasswordForEmail(email);
                                                        if (error) alert(error.message); else alert(t.reset_pw_msg);
                                                    }}
                                                    className="w-full text-center text-[11px] font-bold text-gray-400 hover:text-primary transition-colors pt-2 border-t border-gray-50 mt-2"
                                                >
                                                    {t.find_pw}
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="flex flex-col gap-4">
                                                <button
                                                    disabled={!email || password.length < 6 || password !== confirmPassword}
                                                    onClick={async () => {
                                                        const { error } = await supabase.auth.signUp({ email, password });
                                                        if (error) alert(error.message);
                                                        else {
                                                            alert(t.signup_confirm_msg);
                                                            setAuthMode('login');
                                                        }
                                                    }}
                                                    className="w-full py-4 bg-primary text-white font-black rounded-2xl shadow-lg active:scale-95 transition-transform disabled:opacity-30 disabled:pointer-events-none"
                                                >
                                                    {t.signup_btn}
                                                </button>
                                                <button
                                                    onClick={() => setAuthMode('login')}
                                                    className="text-center text-[11px] font-bold text-gray-400 hover:text-primary transition-colors"
                                                >
                                                    {t.go_to_login}
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                    <button
                                        onClick={() => { setShowAuthModal(false); setAuthMode('login'); setEmail(''); setPassword(''); setConfirmPassword(''); }}
                                        className="mt-8 text-gray-400 font-bold text-xs uppercase"
                                    >
                                        CLOSE
                                    </button>
                                </div>
                            </div>
                        )
                    }

                    {/* My Info Modal */}
                    {
                        showProfileModal && (
                            <div className="fixed inset-0 z-[120000] flex items-center justify-center p-6 bg-black/50 backdrop-blur-md" onClick={() => setShowProfileModal(false)}>
                                <div className="bg-white w-full max-w-2xl rounded-[48px] shadow-2xl overflow-hidden animate-up flex flex-col h-[80vh]" onClick={e => e.stopPropagation()}>
                                    <div className="p-10 pb-6 flex flex-col items-center flex-shrink-0">
                                        <h3 className="text-2xl font-black mb-6 tracking-tighter">{t.my_info}</h3>
                                        <div className="flex gap-2 p-1.5 bg-gray-100 rounded-2xl w-full">
                                            <button onClick={() => setProfileTab('liked')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm transition-all ${profileTab === 'liked' ? 'bg-white text-primary shadow-sm' : 'text-gray-400 hover:text-gray-600'}`}>{t.liked_list}</button>
                                            <button onClick={() => setProfileTab('excluded')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm transition-all ${profileTab === 'excluded' ? 'bg-white text-red-500 shadow-sm' : 'text-gray-400 hover:text-gray-600'}`}>{t.excluded_list}</button>
                                            <button onClick={() => setProfileTab('worldcup')} className={`flex-1 py-3 px-4 rounded-xl font-bold text-sm transition-all ${profileTab === 'worldcup' ? 'bg-white text-yellow-600 shadow-sm' : 'text-gray-400 hover:text-gray-600'}`}>üèÜ {t.worldcup_history}</button>
                                        </div>
                                    </div>
                                    <div className="flex-grow overflow-y-auto px-10 no-scrollbar">
                                        {profileTab === 'worldcup' ? (
                                            <div className="space-y-4 pb-10">
                                                {worldcupHistory.length === 0 ? (
                                                    <div className="py-20 text-center text-gray-300 font-bold">{t.no_data}</div>
                                                ) : (
                                                    worldcupHistory.map((record, idx) => {
                                                        const rawData = window.WEBTOON_DATA || MOCK_WEBTOONS;
                                                        const w = rawData.find(it => (it.titleId || it.id) == record.winner_id);
                                                        return (
                                                            <div key={idx} className="flex gap-4 p-4 rounded-[28px] border border-yellow-100 bg-yellow-50/30 hover:bg-yellow-50 transition-all">
                                                                {w && (
                                                                    <>
                                                                        <div className="w-16 h-20 rounded-xl overflow-hidden flex-shrink-0 bg-gray-100">
                                                                            <img src={w.thumbnailUrl || w.thumbnail} referrerPolicy="no-referrer" className="w-full h-full object-cover" />
                                                                        </div>
                                                                        <div className="flex flex-col justify-center min-w-0 flex-grow">
                                                                            <h4 className="font-extrabold text-gray-900 text-sm truncate tracking-tight">{record.winner_title}</h4>
                                                                            <p className="text-[10px] font-bold text-yellow-600 uppercase mt-1">üèÜ {record.round}{t.worldcup_round} {t.worldcup_winner}</p>
                                                                            <p className="text-[9px] text-gray-400 mt-1">{new Date(record.created_at).toLocaleDateString()}</p>
                                                                        </div>
                                                                    </>
                                                                )}
                                                            </div>
                                                        );
                                                    })
                                                )}
                                            </div>
                                        ) : (
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 pb-10">
                                                {(profileTab === 'liked' ? likedIds : dislikedIds).length === 0 ? (
                                                    <div className="col-span-full py-20 text-center text-gray-300 font-bold">{t.no_data}</div>
                                                ) : (
                                                    (profileTab === 'liked' ? likedIds : dislikedIds).map(id => {
                                                        const rawData = window.WEBTOON_DATA || MOCK_WEBTOONS;
                                                        const w = rawData.find(it => (it.titleId || it.id) == id);
                                                        if (!w) return null;
                                                        const isExcludedFromReco = excludedFromRecoIds.includes(id);
                                                        return (
                                                            <div key={id} className="flex flex-col gap-3 p-4 rounded-[28px] border border-gray-50 bg-gray-50/50 hover:bg-white hover:shadow-soft transition-all group">
                                                                <div className="flex gap-4">
                                                                    <div className="w-16 h-20 rounded-xl overflow-hidden flex-shrink-0 bg-gray-100">
                                                                        <img src={w.thumbnailUrl || w.thumbnail} referrerPolicy="no-referrer" className="w-full h-full object-cover" />
                                                                    </div>
                                                                    <div className="flex flex-col justify-center min-w-0 flex-grow">
                                                                        <h4 className="font-extrabold text-gray-900 text-sm truncate tracking-tight">{w.titleName || w.title}</h4>
                                                                        <p className="text-[10px] font-bold text-gray-400 uppercase mt-1">{(w.tags || []).slice(0, 2).join(' ')}</p>
                                                                    </div>
                                                                    <button
                                                                        onClick={async () => {
                                                                            if (profileTab === 'liked') {
                                                                                await supabase.from('favorite_webtoons').delete().eq('user_id', user.id).eq('webtoon_id', id);
                                                                                setLikedIds(prev => prev.filter(it => it !== id));
                                                                            } else {
                                                                                await supabase.from('excluded_webtoons').delete().eq('user_id', user.id).eq('webtoon_id', id);
                                                                                setDislikedIds(prev => prev.filter(it => it !== id));
                                                                            }
                                                                        }}
                                                                        className="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-white text-gray-300 hover:text-red-500 shadow-sm transition-all"
                                                                    >
                                                                        <svg viewBox="0 0 24 24" className="w-4 h-4 fill-current"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
                                                                    </button>
                                                                </div>
                                                                <div className="flex items-center justify-between px-2 pt-2 border-t border-gray-100">
                                                                    <label className="flex items-center gap-2 cursor-pointer group/toggle">
                                                                        <input
                                                                            type="checkbox"
                                                                            checked={isExcludedFromReco}
                                                                            onChange={async (e) => {
                                                                                const checked = e.target.checked;
                                                                                if (checked) {
                                                                                    await supabase.from('excluded_from_recommendations').insert({ user_id: user.id, webtoon_id: id });
                                                                                    setExcludedFromRecoIds(prev => [...prev, id]);
                                                                                } else {
                                                                                    await supabase.from('excluded_from_recommendations').delete().eq('user_id', user.id).eq('webtoon_id', id);
                                                                                    setExcludedFromRecoIds(prev => prev.filter(it => it !== id));
                                                                                }
                                                                            }}
                                                                            className="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary"
                                                                        />
                                                                        <span className="text-[10px] font-bold text-gray-500 group-hover/toggle:text-gray-700">{t.exclude_from_reco}</span>
                                                                    </label>
                                                                    <span className="text-[9px] text-gray-400">{t.exclude_from_reco_desc}</span>
                                                                </div>
                                                            </div>
                                                        );
                                                    })
                                                )}
                                            </div>
                                        )}
                                    </div>
                                    <div className="p-10 pt-6 border-t border-gray-50 flex flex-col gap-4 flex-shrink-0">
                                        <button
                                            onClick={async () => {
                                                if (confirm(t.delete_confirm)) {
                                                    // Note: Actual user deletion usually requires an edge function.
                                                    // Here we clear all their data as a "soft" deletion from the app perspective.
                                                    await supabase.from('favorite_webtoons').delete().eq('user_id', user.id);
                                                    await supabase.from('excluded_webtoons').delete().eq('user_id', user.id);
                                                    await supabase.auth.signOut();
                                                    alert("All data cleared. Your account is now inactive.");
                                                    setShowProfileModal(false);
                                                }
                                            }}
                                            className="text-[11px] font-bold text-gray-300 hover:text-red-400 transition-colors self-center uppercase border-b border-gray-100"
                                        >
                                            {t.delete_account}
                                        </button>
                                        <button onClick={() => setShowProfileModal(false)} className="w-full py-5 bg-gray-50 rounded-2xl text-gray-400 font-black uppercase">CLOSE</button>
                                    </div>
                                </div>
                            </div>
                        )
                    }

                    {/* Footer with Visitor Counter */}
                    <footer className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-gray-100 py-3 px-4 z-[900]">
                        <div className="max-w-7xl mx-auto flex items-center justify-center gap-6">
                            <div className="flex items-center gap-2">
                                <span className="text-[10px] font-bold text-gray-400 uppercase tracking-wide">{t.today_visitors}</span>
                                <span className="text-sm font-black text-primary">{todayVisitors.toLocaleString()}</span>
                            </div>
                            <div className="w-px h-4 bg-gray-200"></div>
                            <div className="flex items-center gap-2">
                                <span className="text-[10px] font-bold text-gray-400 uppercase tracking-wide">{t.total_visitors}</span>
                                <span className="text-sm font-black text-gray-600">{totalVisitors.toLocaleString()}</span>
                            </div>
                        </div>
                    </footer>
                </div >
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>

</html>