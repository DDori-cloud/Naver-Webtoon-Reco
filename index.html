<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naver Webtoon AI Picker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#8D6E63', bgLight: '#F5F7FA' },
                    boxShadow: { 'soft': '0 10px 40px rgba(0,0,0,0.05)', 'blue': '0 15px 45px rgba(141,110,99,0.2)' }
                }
            }
        }
    </script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #F5F7FA;
            background-image: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)), url('bg.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            -webkit-font-smoothing: antialiased;
        }

        .animate-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <!-- React/Babel CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="data.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Constants ---
        const GENRE_CATEGORIES = [
            {
                name: "ì—°ì¬ ìƒíƒœ",
                genres: ["ì—°ì¬ì¤‘", "ì™„ê²°"]
            },
            {
                name: "ë©”ì¸ ì¥ë¥´",
                genres: ["ë¡œë§¨ìŠ¤", "íŒíƒ€ì§€", "ì•¡ì…˜", "ë“œë¼ë§ˆ", "ìŠ¤ë¦´ëŸ¬", "ë¬´í˜‘/ì‚¬ê·¹", "ê°œê·¸", "ì¼ìƒ", "ê°ì„±", "ìŠ¤í¬ì¸ "]
            },
            {
                name: "ì¸ê¸° ì†Œì¬",
                genres: ["íšŒê·€", "ë¹™ì˜", "ë¨¼ì¹˜í‚¨", "ì•„ì´ëŒ", "ê²Œì„íŒíƒ€ì§€", "ë³µìˆ˜", "í•™ì›ë¬¼", "ì˜¤í”¼ìŠ¤", "ë¡œíŒ", "ì´ì„¸ê³„"]
            },
            {
                name: "ìŠ¤í† ë¦¬ íŠ¹ì§•",
                genres: ["ì‚¬ì´ë‹¤", "íë§", "ì„±ì¥ë¬¼", "ë‘ë‡Œì‹¸ì›€", "ì„œìŠ¤íœìŠ¤"]
            }
        ];

        const PREFERENCES = [
            { id: 'romance', label: 'ë‹¬ë‹¬í•œ ë¡œë§¨ìŠ¤/ì—°ì• ë¬¼' },
            { id: 'action', label: 'í™”ëˆí•œ ì•¡ì…˜ê³¼ íƒ€ê²©ê°' },
            { id: 'brain', label: 'ì‹¬ë¦¬ì „ê³¼ ê³ ë„ì˜ ë‘ë‡Œì‹¸ì›€' },
            { id: 'growth', label: 'ì£¼ì¸ê³µì˜ ì„±ì¥ê³¼ ê°ë™ ì„œì‚¬' },
            { id: 'horror', label: 'ê³µí¬/ê·¸ë¡œí…ŒìŠ¤í¬' }
        ];

        // --- Mock Data (10 Results) ---
        const MOCK_WEBTOONS = [
            {
                id: "641253",
                title: "ì™¸ëª¨ì§€ìƒì£¼ì˜",
                tags: ["ì—í”¼ì†Œë“œ", "ì•¡ì…˜", "ë°•íƒœì¤€", "ê¸ˆìš”ì›¹íˆ°"],
                description: "ì–´ëŠ ë‚  ê·¸ì—ê²Œ ì¼ì–´ë‚œ ê¸°ì  ê°™ì€ ì¼! ëš±ëš±í•˜ê³  ëª»ìƒê²¨ ê³ í†µë°›ë˜ ì£¼ì¸ê³µì´ ì™„ë²½í•œ ëª¸ì„ ê°–ê²Œ ë˜ë©° ë²Œì–´ì§€ëŠ” ë¦¬ì–¼ ì•¡ì…˜ë¬¼.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/641253/thumbnail/thumbnail_IMAG21_d894f11f-668a-4046-8692-730a961f7743.jpg",
                match: 98
            },
            {
                id: "183559",
                title: "ì‹ ì˜ íƒ‘",
                tags: ["íŒíƒ€ì§€", "ë¨¼ì¹˜í‚¨", "ì¥ëŒ€í•œì„œì‚¬"],
                description: "ìì‹ ì˜ ëª¨ë“  ê²ƒì´ì—ˆë˜ ì†Œë…€ ë¼í—¬ì„ ì«“ì•„ íƒ‘ì— ë“¤ì–´ì˜¨ ë°¤. íƒ‘ì„ ì˜¬ë¼ê°€ëŠ” ì´ë“¤ì˜ ê±°ëŒ€í•œ ëª¨í—˜ê³¼ ìš´ëª….",
                thumbnail: "https://image-comic.pstatic.net/webtoon/183559/thumbnail/thumbnail_IMAG21_56133031-69f8-45a7-96a9-858348b4e720.jpg",
                match: 96
            },
            {
                id: "769209",
                title: "í™”ì‚°ê·€í™˜",
                tags: ["ë¬´í˜‘", "íšŒê·€", "ì²­ëª…"],
                description: "ëŒ€ í™”ì‚°íŒŒ 13ëŒ€ ì œì ê°€ ì•„ì´ì˜ ëª¸ìœ¼ë¡œ ê¹¨ì–´ë‚˜ ë©¸ë¬¸í•œ í™”ì‚°íŒŒë¥¼ ë‹¤ì‹œ ì¼ìœ¼í‚¤ëŠ” ì²œí•˜ì œì¼ ì‚¬ì´ë‹¤ ë¬´í˜‘.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/769209/thumbnail/thumbnail_IMAG21_3511196346743900380.jpg",
                match: 95
            },
            {
                id: "747269",
                title: "ì „ì§€ì  ë…ì ì‹œì ",
                tags: ["ì„±ì¢Œë¬¼", "íŒíƒ€ì§€", "ê¹€ë…ì"],
                description: "ë©¸ë§í•œ ì„¸ìƒì˜ ìœ ì¼í•œ ë…ìë§Œì´ ì•„ëŠ” ì†Œì„¤ì˜ ê²°ë§. í‰ë²”í•œ íšŒì‚¬ì›ì´ ì†Œì„¤ ì† ì„¸ê³„ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ ì‚´ì•„ë‚¨ëŠ” ë²•.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/747269/thumbnail/thumbnail_IMAG21_28122349fd894f11.jpg",
                match: 94
            },
            {
                id: "761722",
                title: "ì„¸ê¸°ë§ í’‹ì‚¬ê³¼ ë³´ìŠµí•™ì›",
                tags: ["90ë…„ëŒ€", "ì²­ì¶˜ë¬¼", "ìˆœì •"],
                description: "ì¹˜ì—´í•˜ê²Œ ê³ ë¯¼í•˜ê³  ì‚¬ë‘í•˜ë©° ì„±ì¥í•˜ëŠ” 90ë…„ëŒ€ ì¤‘í•™ìƒë“¤ì˜ ì´ì•¼ê¸°. ìˆœìˆ˜í•¨ê³¼ í’‹í’‹í•¨ì´ ê°€ë“ ë‹´ê¸´ ì²­ì¶˜ ë¡œë§¨ìŠ¤.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/773379/thumbnail/thumbnail_IMAG21_edc03472-a08b-494b-9f93-518420e11893.jpg",
                match: 92
            },
            {
                id: "783060",
                title: "ë‚´ ë‚¨í¸ê³¼ ê²°í˜¼í•´ì¤˜",
                tags: ["íšŒê·€", "ë³µìˆ˜", "ë¡œì½”"],
                description: "ë¯¿ì—ˆë˜ ì‚¬ëŒë“¤ì—ê²Œ ë°°ì‹ ë‹¹í•˜ê³  ì£½ìŒì„ ë§ì´í•œ ê°•ì§€ì›. 10ë…„ ì „ìœ¼ë¡œ ëŒì•„ê°€ ìš´ëª…ì„ ê°œì²™í•˜ê³  ë³µìˆ˜í•˜ëŠ” í†µì¾Œí•œ ì´ì•¼ê¸°.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/781191/thumbnail/thumbnail_IMAG21_51a37c0f-04e4-4638-8c10-e7f5e8f3b25f.jpg",
                match: 91
            },
            {
                id: "735661",
                title: "ì¬í˜¼ í™©í›„",
                tags: ["ë¡œíŒ", "ì‚¬ì´ë‹¤", "í™©ê¶"],
                description: "ëª…ë§ ë†’ì€ ê°€ë¬¸ì˜ ì™„ë²½í•œ í™©í›„ì˜€ì§€ë§Œ, í™©ì œì˜ ë°°ì‹ ìœ¼ë¡œ ì´í˜¼ì„ ì„ íƒí•˜ê³  ë‹¹ë‹¹í•˜ê²Œ ì¬í˜¼ì„ ë°œí‘œí•˜ëŠ” ê±¸í¬ëŸ¬ì‹œ ë¡œíŒ.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/735661/thumbnail/thumbnail_IMAG21_k735661.jpg",
                match: 89
            },
            {
                id: "703844",
                title: "ê°€ë¹„ì§€íƒ€ì„",
                tags: ["ìŠ¤í¬ì¸ ", "ë†êµ¬", "ê³ êµìƒí™œ"],
                description: "ìµœí•˜ìœ„ ë†êµ¬ë¶€ ì§€ìƒê³ ì˜ ëœ¨ê±°ìš´ ë°˜ë€. í•œêµ­ ê³ êµ ë†êµ¬ì˜ í˜„ì‹¤ê³¼ ì„±ì¥ì„ ìƒìƒí•˜ê²Œ ë‹´ì•„ë‚¸ ê±¸ì‘.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/703844/thumbnail/thumbnail_IMAG21_k703844.jpg",
                match: 87
            },
            {
                id: "710751",
                title: "ì•½í•œì˜ì›…",
                tags: ["í•™ì›ì•¡ì…˜", "ì—°ì‹œì€", "ë‘ë‡Œ"],
                description: "ì™œì†Œí•œ ì²´êµ¬ì§€ë§Œ ì••ë„ì ì¸ ë‘ë‡Œì™€ ë„êµ¬ë¡œ ì¼ì§„ë“¤ì„ ì••ì‚´í•˜ëŠ” ì†Œë…„ ì—°ì‹œì€ì˜ ì¹˜ì—´í•œ ìƒì¡´ ì•¡ì…˜.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/710751/thumbnail/thumbnail_IMAG21_k710751.jpg",
                match: 85
            },
            {
                id: "651673",
                title: "ìœ ë¯¸ì˜ ì„¸í¬ë“¤",
                tags: ["ì¼ìƒ", "ì‹¬ë¦¬ë¬˜ì‚¬", "ë¡œì½”"],
                description: "ìœ ë¯¸ì˜ ë¨¸ë¦¿ì† ì„¸í¬ë“¤ì´ ë§Œë“¤ì–´ ë‚˜ê°€ëŠ” ìœ ì¹­ì°¬ ì—°ì• ì™€ ì„±ì¥ ì´ì•¼ê¸°. ì„¸í¬ë“¤ì˜ ê·€ì—¬ìš´ ë°˜ë€.",
                thumbnail: "https://image-comic.pstatic.net/webtoon/653866/thumbnail/thumbnail_IMAG21_0920420f-0a15-46f9-aa2f-3d606f7535b4.jpg",
                match: 84
            }
        ];

        // --- UI Components ---
        const ProgressBar = ({ step }) => (
            <div className="mb-10 max-w-2xl mx-auto px-6">
                <div className="h-2 w-full bg-gray-200 rounded-full overflow-hidden">
                    <div className="h-full bg-primary transition-all duration-700 ease-out" style={{ width: `${(step / 4) * 100}%` }}></div>
                </div>
                <div className="mt-4 flex justify-between text-[11px] font-bold text-gray-400 uppercase tracking-widest">
                    <span>Analysis Process</span>
                    <span className="text-primary">Step {step} of 4</span>
                </div>
            </div>
        );

        const WebtoonCard = ({ item, rank, onExclude }) => {
            const getRankDisplay = (r) => {
                if (r === 1) return <span className="text-lg mr-1.5 drop-shadow-sm">ğŸ¥‡</span>;
                if (r === 2) return <span className="text-lg mr-1.5 drop-shadow-sm">ğŸ¥ˆ</span>;
                if (r === 3) return <span className="text-lg mr-1.5 drop-shadow-sm">ğŸ¥‰</span>;
                return <span className="text-base font-black text-gray-300 mr-2 italic">{r}</span>;
            };

            return (
                <div className="bg-white rounded-[32px] overflow-hidden shadow-soft hover:shadow-xl transition-all duration-500 transform hover:-translate-y-2 flex flex-col relative group border border-gray-50 h-full">

                    {/* ì¸ë„¤ì¼ */}
                    <div className="relative aspect-[3/4] overflow-hidden bg-gray-100">
                        <img
                            src={item.thumbnail}
                            referrerPolicy="no-referrer"
                            alt={item.title}
                            className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                            onError={(e) => { e.target.src = "https://via.placeholder.com/400?text=ì´ë¯¸ì§€ì—†ìŒ"; }}
                        />
                        {/* ë§¤ì¹­ ì ìˆ˜ ë±ƒì§€: ìš°ì¸¡ í•˜ë‹¨ ëª¨ì„œë¦¬ ë°€ì°© */}
                        <div className="absolute bottom-1 right-1 z-20 bg-primary/95 text-white text-[10px] font-bold px-2 py-0.5 rounded-lg shadow-md backdrop-blur-sm">
                            {item.match}%
                        </div>
                    </div>

                    {/* ì½˜í…ì¸  */}
                    <div className="p-4 flex flex-col flex-grow">
                        {/* íƒœê·¸ ì˜ì—­: ë†’ì´ 5.5rem, ì—¬ë°± mb-2 */}
                        <div className="flex flex-wrap gap-1 mb-2 h-[5.5rem] content-start overflow-hidden">
                            {item.tags.slice(0, 10).map((tag, idx) => (
                                <span key={idx} className="text-[9px] font-bold text-primary bg-orange-50 px-1.5 py-0.5 rounded-md tracking-tighter">#{tag}</span>
                            ))}
                        </div>

                        {/* ë­í‚¹ + ì œëª© ì˜ì—­ */}
                        <div className="flex items-start mb-2 h-[2.5rem]">
                            <div className="flex-shrink-0 flex items-center h-full pt-0.5">
                                {getRankDisplay(rank)}
                            </div>
                            <h3 className="text-sm font-extrabold text-gray-900 leading-tight line-clamp-2 self-center">{item.title}</h3>
                        </div>

                        {/* í•˜ë‹¨ ì˜ì—­ */}
                        <div className="mt-auto w-full">
                            <div className="flex items-center justify-between mb-2">
                                {item.starScore && (
                                    <div className="text-[10px] font-bold text-yellow-500 text-left">
                                        â˜… {item.starScore.toFixed(2)}
                                    </div>
                                )}
                                <button
                                    onClick={() => onExclude(item.id)}
                                    className="text-[9px] font-bold text-gray-400 hover:text-red-400 transition-colors border-b border-gray-200 hover:border-red-200"
                                >
                                    ì¶”ì²œì œì™¸
                                </button>
                            </div>

                            <a
                                href={`https://comic.naver.com/webtoon/list?titleId=${item.id}`}
                                target="_blank"
                                className="block w-full py-2.5 bg-primary text-white text-center rounded-xl font-bold hover:opacity-90 transition-all text-xs"
                            >
                                ë°”ë¡œë³´ê¸°
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [step, setStep] = useState(1);
            const [selectedG, setSelectedG] = useState([]);
            const [prefSettings, setPrefSettings] = useState({});
            const [favTitle, setFavTitle] = useState("");
            const [loading, setLoading] = useState(false);
            const [results, setResults] = useState([]);
            const [scoredPool, setScoredPool] = useState([]); // ì „ì²´ ë§¤ì¹­ ë°ì´í„° ë³´ê´€

            const [excludedIds, setExcludedIds] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('excludedWebtoons')) || [];
                } catch (e) {
                    return [];
                }
            });
            const [showExcludePopup, setShowExcludePopup] = useState(false);

            const nextStep = () => setStep(step + 1);
            const prevStep = () => setStep(step - 1);
            const reset = () => {
                setStep(1);
                setSelectedG([]);
                setPrefSettings({});
                setFavTitle("");
                setScoredPool([]);
                window.scrollTo(0, 0);
            };

            const handleExclude = (id) => {
                const newExcludes = [...excludedIds, id];
                setExcludedIds(newExcludes);
                localStorage.setItem('excludedWebtoons', JSON.stringify(newExcludes));

                // ì „ì²´ í’€(scoredPool)ì—ì„œ ì œì™¸ ëŒ€ìƒì„ ê±°ë¥´ê³  í•­ìƒ ìƒìœ„ 10ê°œë¥¼ ë‹¤ì‹œ ë½‘ì•„ resultsë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.
                if (scoredPool && scoredPool.length > 0) {
                    const replenished = scoredPool
                        .filter(w => !newExcludes.includes(w.id))
                        .slice(0, 10);
                    setResults(replenished);
                } else {
                    // ë¶„ì„ ë°ì´í„° í’€ì´ ì—†ëŠ” ê²½ìš°ì— ëŒ€ë¹„í•œ ê¸°ë³¸ ë¡œì§
                    setResults(prev => prev.filter(w => w.id !== id));
                }

                setShowExcludePopup(true);
                setTimeout(() => setShowExcludePopup(false), 2000);
            };

            const handleAnalyze = async () => {
                setLoading(true); setStep(4);
                await new Promise(r => setTimeout(r, 1500));

                const rawData = window.WEBTOON_DATA || MOCK_WEBTOONS;
                const userSelections = selectedG;

                // 1. Separate Status Filter and Preferences
                const statusFilters = userSelections.filter(s => ["ì—°ì¬ì¤‘", "ì™„ê²°"].includes(s));
                const genrePreferences = userSelections.filter(s => !["ì—°ì¬ì¤‘", "ì™„ê²°"].includes(s));

                // 2. Identify Favorite Webtoon & Extract its Tags (Fuzzy Match)
                let favTags = [];
                let favAuthor = "";
                if (favTitle.trim()) {
                    const search = favTitle.toLowerCase().replace(/\s+/g, '');
                    const found = rawData.find(w => {
                        const t = (w.titleName || w.title || "").toLowerCase().replace(/\s+/g, '');
                        return t.includes(search) || search.includes(t);
                    });
                    if (found) {
                        favTags = found.tags || [];
                        favAuthor = found.author || "";
                    }
                }

                // 3. Data Normalization
                const dataset = rawData.map(item => ({
                    id: item.titleId || item.id,
                    title: item.titleName || item.title,
                    thumbnail: item.thumbnailUrl || item.thumbnail,
                    tags: (item.tags && item.tags.length > 0) ? item.tags : [item.day, item.status === 'FINISHED' ? 'ì™„ê²°' : 'ì—°ì¬ì¤‘', item.author].filter(Boolean),
                    author: item.author,
                    status: item.status,
                    starScore: item.starScore || 9.0
                }));

                // 4. Scoring Algorithm
                const scoredData = dataset.map(webtoon => {
                    let score = 50;
                    let matches = 0;
                    let isStatusMatch = true;

                    // A. Status Check
                    if (statusFilters.length > 0) {
                        const statusMap = { 'FINISHED': 'ì™„ê²°', 'ONGOING': 'ì—°ì¬ì¤‘' };
                        const myStatus = statusMap[webtoon.status] || webtoon.status;
                        const hasStatusTag = webtoon.tags && webtoon.tags.some(t => statusFilters.includes(t));
                        if (!statusFilters.includes(myStatus) && !hasStatusTag) isStatusMatch = false;
                    }
                    if (!isStatusMatch) return { ...webtoon, match: 0 };

                    // B. Genre Preferences
                    genrePreferences.forEach(pref => {
                        let keywords = [pref];
                        if (pref.includes('/')) keywords = pref.split('/');
                        const hasMatch = keywords.some(k =>
                            (webtoon.tags && webtoon.tags.some(t => String(t).includes(k))) ||
                            (webtoon.title && webtoon.title.includes(k))
                        );
                        if (hasMatch) { score += 20; matches++; }
                    });

                    // C. Favorite Webtoon Similarity
                    if (favTags.length > 0) {
                        const sharedTags = webtoon.tags.filter(t => favTags.includes(t));
                        score += (sharedTags.length * 3);
                    }
                    if (favAuthor && webtoon.author === favAuthor) score += 10;

                    if (favTitle && webtoon.title.replace(/\s+/g, '') === favTitle.replace(/\s+/g, '')) score = 0;

                    score += Math.floor(Math.random() * 5); // Variance
                    return { ...webtoon, match: Math.min(99, score) };
                });

                const allMatches = scoredData
                    .filter(w => w.match > 0)
                    .sort((a, b) => b.match - a.match);

                setScoredPool(allMatches);
                setResults(allMatches.filter(w => !excludedIds.includes(w.id)).slice(0, 10));
                setLoading(false);
            };


            const handleShare = (e) => {
                if (e) e.preventDefault();
                if (results.length === 0) {
                    alert("ê³µìœ í•  ì¶”ì²œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¶„ì„ì„ ì‹œì‘í•´ì£¼ì„¸ìš”!");
                    return;
                }

                const shareText = `[AI ì¶”ì²œ ë„¤ì´ë²„ ì›¹íˆ°]\n\n` +
                    results.map((w, i) => {
                        const isFinished = w.status === 'FINISHED' || (w.tags && w.tags.includes('ì™„ê²°'));
                        return `${i + 1}. ${w.title} (${isFinished ? 'ì™„ê²°' : 'ì—°ì¬ì¤‘'})`;
                    }).join('\n') +
                    `\n\nğŸ”— ë‚˜ë„ í•´ë³´ê¸°: https://comic.naver.com/index (AIR.NW)`;

                const textArea = document.createElement("textarea");
                textArea.value = shareText;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                textArea.style.top = "0";
                document.body.appendChild(textArea);
                textArea.select();

                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        alert("ë¶„ì„ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.");
                    } else {
                        throw new Error("execCommand failed");
                    }
                } catch (err) {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(shareText)
                            .then(() => alert("ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"))
                            .catch(() => alert("ë³´ì•ˆ ì„¤ì •ìœ¼ë¡œ ì¸í•´ ë³µì‚¬ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤."));
                    } else {
                        alert("ë³µì‚¬ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
                    }
                }
                document.body.removeChild(textArea);
            };

            return (
                <div className="min-h-screen">
                    <header className="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-100">
                        <div className="max-w-6xl mx-auto px-8 h-20 flex items-center justify-between relative">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={reset}>
                                <span className="text-2xl drop-shadow-md">ğŸ“–</span>
                                <h1 className="text-xl font-black text-gray-900 tracking-tighter">AIR<span className="text-primary italic">.NW</span></h1>
                            </div>

                            <div className="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2">
                                <h1 className="text-2xl font-black text-gray-800 tracking-tighter italic">My Pick Toon</h1>
                            </div>

                            {step === 4 && !loading && (
                                <button onClick={handleShare} className="animate-pulse text-[10px] font-bold text-primary hover:text-white transition-all uppercase tracking-widest border-2 border-primary hover:bg-primary px-4 py-2 rounded-full bg-white shadow-lg flex items-center gap-2">
                                    <span>SHARE</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-3 h-3">
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                                    </svg>
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-8 py-12">
                        <ProgressBar step={step} />

                        {step === 1 && (
                            <div className="animate-up max-w-4xl mx-auto">
                                <div className="text-center mb-14">
                                    <h2 className="text-4xl font-black text-gray-900 mb-4 tracking-tight">ì·¨í–¥ì„ ê³¨ë¼ì£¼ì„¸ìš”.</h2>
                                    <p className="text-gray-400 font-medium italic">ë‹¤ì–‘í•œ ì¥ë¥´ ì¤‘ 1ê°œ ì´ìƒ ì„ íƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.</p>
                                </div>
                                <div className="space-y-10">
                                    {GENRE_CATEGORIES.map(cat => (
                                        <div key={cat.name} className="space-y-5">
                                            <h3 className="text-sm font-bold text-gray-800 flex items-center gap-3">
                                                <span className="w-1.5 h-4 bg-primary rounded-full"></span>
                                                {cat.name}
                                            </h3>
                                            <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                                                {cat.genres.map(g => (
                                                    <button
                                                        key={g}
                                                        onClick={() => setSelectedG(prev => prev.includes(g) ? prev.filter(it => it !== g) : [...prev, g])}
                                                        className={`py-4 px-5 rounded-[20px] text-[13px] font-bold border-2 transition-all ${selectedG.includes(g) ? 'bg-primary border-primary text-white shadow-xl shadow-gray-200 scale-[0.97]' : 'bg-white border-gray-100 text-gray-500 hover:border-gray-200'}`}
                                                    >#{g}</button>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-20 text-center">
                                    <button
                                        disabled={selectedG.length === 0}
                                        onClick={nextStep}
                                        className="px-16 py-5 bg-primary text-white font-black rounded-full shadow-2xl shadow-gray-300 disabled:opacity-20 hover:scale-105 hover:bg-[#3E2723] active:scale-95 transition-all text-lg"
                                    >Next Step</button>
                                </div>
                            </div>
                        )}

                        {step === 2 && (
                            <div className="animate-up max-w-lg mx-auto py-10">
                                <h2 className="text-3xl font-black text-center mb-12">ì„ í˜¸ í…Œë§ˆ ì„¤ì •</h2>
                                <div className="space-y-3 bg-white p-2 rounded-[40px] shadow-soft border border-gray-50">
                                    {PREFERENCES.map(p => {
                                        return (
                                            <div key={p.id} className="flex items-center justify-between p-7 border-b last:border-0 border-gray-50 cursor-pointer hover:bg-gray-50 transition-colors"
                                                onClick={() => setPrefSettings(prev => ({ ...prev, [p.id]: !prev[p.id] }))}>
                                                <span className={`font-bold transition-colors ${prefSettings[p.id] ? 'text-primary' : 'text-gray-700'}`}>{p.label}</span>
                                                <div className={`w-12 h-7 rounded-full relative transition-colors duration-300 ${prefSettings[p.id] ? 'bg-primary' : 'bg-gray-200'}`}>
                                                    <div className={`absolute top-1 w-5 h-5 bg-white rounded-full shadow-sm transition-transform duration-300 ${prefSettings[p.id] ? 'translate-x-[22px]' : 'translate-x-1'}`}></div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="mt-14 flex justify-center gap-4">
                                    <button onClick={prevStep} className="px-8 py-5 bg-gray-100 text-gray-500 font-bold rounded-full">Back</button>
                                    <button onClick={nextStep} className="px-12 py-5 bg-primary text-white font-black rounded-full shadow-2xl shadow-gray-300">Continue</button>
                                </div>
                            </div>
                        )}

                        {step === 3 && (
                            <div className="animate-up max-w-lg mx-auto py-10">
                                <h2 className="text-3xl font-black text-center mb-10 leading-tight">ê°€ì¥ ì¬ë¯¸ìˆê²Œ ë³´ì‹ <br />ì›¹íˆ°ì€ ë¬´ì—‡ì¸ê°€ìš”?</h2>
                                <input
                                    type="text"
                                    value={favTitle}
                                    onChange={e => setFavTitle(e.target.value)}
                                    placeholder="ì •í™•í•œ ì œëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”"
                                    className="w-full py-6 px-10 rounded-full bg-white border-4 border-gray-50 focus:border-primary outline-none transition-all font-bold text-lg shadow-inner text-center"
                                />
                                <div className="mt-14 flex justify-center gap-4">
                                    <button onClick={prevStep} className="px-8 py-5 bg-gray-100 text-gray-500 font-bold rounded-full">Back</button>
                                    <button onClick={handleAnalyze} className="px-12 py-5 bg-primary text-white font-black rounded-full shadow-2xl shadow-blue-200">Start Analysis</button>
                                </div>
                            </div>
                        )}

                        {step === 4 && (
                            <div className="animate-up">
                                {loading ? (
                                    <div className="flex flex-col items-center justify-center py-32">
                                        <div className="w-16 h-16 border-[10px] border-gray-200 border-t-primary rounded-full animate-spin mb-10"></div>
                                        <p className="text-gray-400 font-black tracking-widest uppercase animate-pulse">Computing Result...</p>
                                    </div>
                                ) : (
                                    <div className="animate-up">
                                        <div className="sticky top-[80px] z-40 bg-white/95 backdrop-blur-sm -mx-8 px-8 py-10 mb-6 border-b border-gray-50 shadow-sm">
                                            <div className="text-center">
                                                <h2 className="text-3xl font-black text-gray-900 mb-3 tracking-tight italic">AI Best Recommendations</h2>
                                                <p className="text-gray-400 font-medium">ì‚¬ìš©ìì˜ ê³ ìœ  ì·¨í–¥ì„ ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
                                            {results.map((w, idx) => (
                                                <WebtoonCard
                                                    key={w.id}
                                                    item={w}
                                                    rank={idx + 1}
                                                    onExclude={handleExclude}
                                                />
                                            ))}
                                        </div>
                                        <div className="text-center mt-24">
                                            <button onClick={reset} className="px-12 py-5 border-4 border-gray-100 text-gray-300 font-black rounded-full hover:border-primary hover:text-primary transition-all uppercase tracking-tighter">New Analysis</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* ì¶”ì²œ ì œì™¸ íŒì—… */}
                    {showExcludePopup && (
                        <div className="fixed bottom-10 left-1/2 transform -translate-x-1/2 z-[100] animate-up">
                            <div className="bg-gray-900/90 backdrop-blur-md text-white px-8 py-4 rounded-2xl shadow-2xl flex items-center gap-3">
                                <span className="text-xl">ğŸš«</span>
                                <p className="font-bold text-sm">ì•ìœ¼ë¡œ ì´ ì›¹íˆ°ì€ ì¶”ì²œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>